<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#e8f4fc">
  <title>Aclio</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      /* Core Colors - Aclio Light Blue Theme */
      --bg: #e8f4fc;
      --bg-card: #ffffff;
      --bg-top: #e8f4fc;
      --bg-bottom: #c5e3f3;
      
      /* Text */
      --text: #1a2b4a;
      --text-dim: #4a5568;
      --text-dimmer: #718096;
      
      /* Primary - Aclio Orange */
      --accent: #FF9F43;
      --accent-light: #FFB347;
      --accent-soft: rgba(255, 159, 67, 0.15);
      --accent-softer: rgba(255, 159, 67, 0.08);
      
      /* Status */
      --success: #22C55E;
      --success-soft: rgba(34, 197, 94, 0.1);
      --gold: #FFB347;
      --gold-soft: rgba(255, 179, 71, 0.15);
      
      /* Other */
      --purple: #8b5cf6;
      --purple-soft: rgba(139, 92, 246, 0.1);
      --orange: #FF9F43;
      --orange-soft: rgba(255, 159, 67, 0.15);
      --pink: #ec4899;
      --red: #ef4444;
      
      /* UI */
      --border: #d4e5ed;
      --dot-inactive: rgba(255, 159, 67, 0.3);
      --shadow: 0 2px 8px rgba(26, 43, 74, 0.08);
      --shadow-md: 0 8px 24px rgba(26, 43, 74, 0.1);
      --shadow-lg: 0 12px 32px rgba(26, 43, 74, 0.15);
      --shadow-btn: 0 8px 30px rgba(255, 159, 67, 0.4);
      
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    
    /* Dark Mode - Aclio Dark Theme */
    .dark {
      --bg: #1a2b4a;
      --bg-card: #243554;
      --bg-top: #1a2b4a;
      --bg-bottom: #0f1a2e;
      --text: #f1f5f9;
      --text-dim: #94a3b8;
      --text-dimmer: #64748b;
      --accent: #FFB347;
      --accent-light: #FFC978;
      --accent-soft: rgba(255, 179, 71, 0.2);
      --accent-softer: rgba(255, 179, 71, 0.1);
      --success: #34D399;
      --success-soft: rgba(52, 211, 153, 0.15);
      --gold: #FFB347;
      --gold-soft: rgba(255, 179, 71, 0.2);
      --purple: #a78bfa;
      --purple-soft: rgba(167, 139, 250, 0.15);
      --orange: #FFB347;
      --orange-soft: rgba(255, 179, 71, 0.2);
      --pink: #f472b6;
      --red: #f87171;
      --border: #3d5070;
      --dot-inactive: rgba(255, 179, 71, 0.3);
      --shadow: 0 2px 8px rgba(0,0,0,0.3);
      --shadow-md: 0 8px 24px rgba(0,0,0,0.4);
      --shadow-lg: 0 12px 32px rgba(0,0,0,0.5);
      --shadow-btn: 0 8px 30px rgba(255, 179, 71, 0.35);
    }
    
    html, body { 
      height: 100%;
      min-height: 100%;
      margin: 0;
      padding: 0;
      background: var(--bg-top);
    }
    
    body { 
      font-family: 'Inter', -apple-system, sans-serif;
      background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bottom) 100%);
      background-attachment: fixed;
      color: var(--text); 
      line-height: 1.5;
    }
    
    #root { 
      min-height: 100%;
      height: 100%;
    }
    
    /* Prevent scroll bounce on welcome/onboarding */
    .app-no-scroll {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
      background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-bottom) 100%);
    }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .fade-in { animation: fadeIn 0.4s ease; }
    .slide-up { animation: slideUp 0.5s ease backwards; }
    .spin { animation: spin 1s linear infinite; display: inline-block; }
    
    /* ============ APP ============ */
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100%;
      background: var(--bg);
      padding-top: env(safe-area-inset-top, 0);
      padding-bottom: env(safe-area-inset-bottom, 0);
    }
    
    /* ============ HEADER ============ */
    .header {
      position: sticky;
      top: 0;
      z-index: 50;
      background: var(--bg-card);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding: calc(var(--safe-top) + 10px) 16px 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border);
    }
    
    .header-left { display: flex; align-items: center; gap: 12px; }
    .header-back { 
      width: 36px; height: 36px; 
      display: flex; align-items: center; justify-content: center;
      background: var(--bg); border: none; border-radius: 10px;
      cursor: pointer; color: var(--text);
      transition: background 0.2s;
    }
    .header-back:hover { background: var(--border); }
    .header-back svg { width: 20px; height: 20px; }
    .header-title { font-size: 17px; font-weight: 700; }
    .header-right { display: flex; align-items: center; gap: 6px; }
    .header-icon {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      background: var(--bg); border: none; cursor: pointer; color: var(--text-dim);
      border-radius: 10px;
      transition: all 0.2s;
    }
    .header-icon:hover { background: var(--border); color: var(--text); }
    .header-icon:active { transform: scale(0.95); }
    .header-icon svg { width: 20px; height: 20px; }
    
    /* ============ DASHBOARD ============ */
    .dashboard {
      padding: 16px;
      padding-bottom: calc(var(--safe-bottom) + 100px);
    }
    
    /* Greeting */
    .greeting-section { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: flex-start; }
    .greeting-text { font-size: 13px; color: var(--text-dim); margin-bottom: 2px; }
    .greeting-name { font-size: 22px; font-weight: 800; }
    .streak-badge {
      display: flex; align-items: center; gap: 5px;
      padding: 6px 12px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border-radius: 10px;
      color: #fff;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(255, 159, 67, 0.3);
    }
    .streak-badge svg { width: 14px; height: 14px; }
    
    /* Section */
    .section { margin-bottom: 24px; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .section-title { font-size: 16px; font-weight: 700; }
    .section-link { color: var(--accent); font-size: 13px; font-weight: 600; background: none; border: none; cursor: pointer; }
    
    /* Today's Focus Card */
    .focus-card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border);
    }
    .focus-header { display: flex; align-items: center; gap: 8px; margin-bottom: 14px; }
    .focus-icon { 
      width: 28px; height: 28px;
      background: var(--accent-softer);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      color: var(--accent);
    }
    .focus-icon svg { width: 16px; height: 16px; }
    .focus-title { font-size: 15px; font-weight: 700; color: var(--text); }
    
    .focus-item {
      display: flex; align-items: center; gap: 12px;
      padding: 12px;
      margin: 0 -12px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .focus-item:hover { background: var(--bg); }
    .focus-item:last-child { margin-bottom: -4px; }
    .focus-item:first-of-type { margin-top: -4px; }
    
    .focus-check {
      width: 22px; height: 22px;
      border: 2px solid var(--border);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      color: #fff;
      font-size: 11px;
      transition: all 0.2s;
    }
    .focus-check:hover { border-color: var(--success); }
    .focus-check.checked { background: var(--success); border-color: var(--success); }
    
    .focus-content { flex: 1; min-width: 0; }
    .focus-task { font-size: 14px; font-weight: 500; color: var(--text); margin-bottom: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .focus-task.done { text-decoration: line-through; color: var(--text-dim); }
    .focus-goal { font-size: 12px; color: var(--text-dim); }
    
    /* Goal Card */
    .goal-card-wrapper {
      position: relative;
      margin-bottom: 12px;
      overflow: hidden;
      border-radius: 16px;
    }
    .goal-card-delete {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 80px;
      background: linear-gradient(135deg, #ef4444, #dc2626);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      border-radius: 0 16px 16px 0;
    }
    .goal-card-delete svg { width: 22px; height: 22px; }
    .goal-card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      z-index: 1;
    }
    .goal-card:hover { border-color: var(--accent); }
    .goal-card.swiping { transition: none; }
    .goal-card:active { transform: scale(0.99); }
    
    /* Pull to Refresh */
    .pull-refresh-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      color: var(--text-dim);
      font-size: 13px;
      gap: 8px;
      opacity: 0;
      transform: translateY(-40px);
      transition: opacity 0.2s, transform 0.2s;
    }
    .pull-refresh-indicator.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .pull-refresh-indicator.refreshing .pull-refresh-icon {
      animation: spin 1s linear infinite;
    }
    .pull-refresh-icon { width: 18px; height: 18px; }
    
    .goal-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
    .goal-icon-wrap {
      width: 44px; height: 44px;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    .goal-icon-wrap svg { width: 22px; height: 22px; }
    .goal-info { flex: 1; min-width: 0; }
    .goal-name { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .goal-category { font-size: 12px; color: var(--text-dim); }
    
    .goal-progress-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .goal-progress-label { font-size: 12px; color: var(--text-dim); }
    .goal-progress-value { font-size: 13px; font-weight: 700; color: var(--accent); }
    
    .goal-progress-bar { height: 6px; background: var(--bg); border-radius: 100px; overflow: hidden; margin-bottom: 12px; }
    .goal-progress-fill { height: 100%; background: linear-gradient(90deg, var(--accent) 0%, var(--accent-light) 100%); border-radius: 100px; transition: width 0.5s ease; }
    
    .goal-next { display: flex; align-items: center; gap: 8px; padding: 10px 12px; background: var(--bg); border-radius: 10px; }
    .goal-next-arrow { color: var(--accent); display: flex; flex-shrink: 0; }
    .goal-next-arrow svg { width: 16px; height: 16px; }
    .goal-next-text { font-size: 13px; color: var(--text-dim); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    /* Achievements */
    .achievements-scroll { 
      display: flex; gap: 14px; 
      overflow-x: auto; 
      padding-bottom: 8px;
      margin: 0 -20px;
      padding-left: 20px;
      padding-right: 20px;
      scroll-snap-type: x mandatory;
    }
    .achievements-scroll::-webkit-scrollbar { display: none; }
    
    .achievement-card {
      flex-shrink: 0;
      width: 200px;
      padding: 20px;
      border-radius: 20px;
      color: #fff;
      scroll-snap-align: start;
    }
    .achievement-icon { 
      width: 44px; height: 44px; 
      background: rgba(255,255,255,0.2); 
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 40px;
    }
    .achievement-icon svg { width: 22px; height: 22px; }
    .achievement-title { font-size: 16px; font-weight: 700; margin-bottom: 6px; }
    .achievement-desc { font-size: 12px; opacity: 0.85; margin-bottom: 8px; line-height: 1.4; }
    .achievement-date { font-size: 11px; opacity: 0.7; }
    .achievement-card.locked { opacity: 0.4; filter: grayscale(1); }
    .achievement-card.locked .achievement-icon { background: rgba(255,255,255,0.1); }
    
    /* Share Celebration Card */
    .share-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 200; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .share-card-container { width: 100%; max-width: 380px; }
    .share-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      border-radius: 24px;
      padding: 40px 30px;
      text-align: center;
      color: #fff;
      position: relative;
      overflow: hidden;
    }
    .share-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
      animation: shimmer 3s ease-in-out infinite;
    }
    @keyframes shimmer { 0%, 100% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } }
    .share-card-content { position: relative; z-index: 1; }
    .share-card-confetti { font-size: 48px; margin-bottom: 16px; }
    .share-card-badge { 
      width: 80px; height: 80px; 
      background: rgba(255,255,255,0.2); 
      border-radius: 50%; 
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px;
      font-size: 40px;
    }
    .share-card-title { font-size: 28px; font-weight: 800; margin-bottom: 8px; text-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    .share-card-subtitle { font-size: 14px; opacity: 0.9; margin-bottom: 24px; }
    .share-card-goal { 
      background: rgba(255,255,255,0.15); 
      border-radius: 16px; 
      padding: 20px; 
      margin-bottom: 24px;
      backdrop-filter: blur(10px);
    }
    .share-card-goal-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; margin-bottom: 8px; }
    .share-card-goal-name { font-size: 20px; font-weight: 700; line-height: 1.3; }
    .share-card-stats { display: flex; justify-content: center; gap: 32px; margin-bottom: 24px; }
    .share-card-stat { text-align: center; }
    .share-card-stat-value { font-size: 24px; font-weight: 800; }
    .share-card-stat-label { font-size: 11px; opacity: 0.8; text-transform: uppercase; }
    .share-card-footer { font-size: 12px; opacity: 0.7; }
    .share-card-logo { display: flex; align-items: center; justify-content: center; gap: 6px; margin-top: 16px; }
    .share-card-logo svg { width: 18px; height: 18px; }
    
    .share-actions { display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap; justify-content: center; }
    .share-btn {
      display: flex; align-items: center; gap: 8px;
      padding: 14px 24px;
      background: #fff;
      border: none;
      border-radius: 100px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .share-btn:active { transform: scale(0.95); }
    .share-btn.primary { background: var(--accent); color: #fff; }
    .share-btn.twitter { background: #1DA1F2; color: #fff; }
    .share-btn.whatsapp { background: #25D366; color: #fff; }
    .share-btn.download { background: #10b981; color: #fff; }
    .share-btn svg { width: 18px; height: 18px; }
    .share-close { 
      position: absolute; top: 16px; right: 16px;
      width: 36px; height: 36px;
      background: rgba(255,255,255,0.2);
      border: none; border-radius: 50%;
      color: #fff;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }
    
    /* Goal Header Share Button */
    .goal-share-btn {
      width: 40px; height: 40px;
      background: var(--accent-soft);
      border: none; border-radius: 50%;
      color: var(--accent);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.2s;
    }
    .goal-share-btn:active { transform: scale(0.9); }
    .goal-share-btn svg { width: 18px; height: 18px; }
    
    /* Premium Paywall */
    .paywall-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 300; display: flex; align-items: flex-end; justify-content: center; }
    .paywall-content {
      width: 100%;
      max-width: 500px;
      background: var(--bg);
      border-radius: 28px 28px 0 0;
      padding: 32px 24px calc(var(--safe-bottom) + 24px);
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUpPaywall 0.4s ease;
    }
    @keyframes slideUpPaywall { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .paywall-close { position: absolute; top: 16px; right: 16px; width: 36px; height: 36px; background: var(--border); border: none; border-radius: 50%; color: var(--text-dim); cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .paywall-badge { 
      display: inline-flex; align-items: center; gap: 6px;
      background: linear-gradient(135deg, #FFD700, #FFA500); 
      color: #000; 
      padding: 8px 16px; 
      border-radius: 100px; 
      font-size: 12px; 
      font-weight: 700; 
      text-transform: uppercase;
      margin-bottom: 16px;
    }
    .paywall-title { font-size: 28px; font-weight: 800; margin-bottom: 8px; line-height: 1.2; }
    .paywall-subtitle { font-size: 16px; color: var(--text-dim); margin-bottom: 24px; line-height: 1.5; }
    
    .paywall-features { margin-bottom: 28px; }
    .paywall-feature {
      display: flex; align-items: flex-start; gap: 14px;
      padding: 14px 0;
      border-bottom: 1px solid var(--border);
    }
    .paywall-feature:last-child { border-bottom: none; }
    .paywall-feature-icon {
      width: 44px; height: 44px;
      background: var(--accent-soft);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      color: var(--accent);
      flex-shrink: 0;
    }
    .paywall-feature-icon svg { width: 22px; height: 22px; }
    .paywall-feature-text h4 { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
    .paywall-feature-text p { font-size: 13px; color: var(--text-dim); line-height: 1.4; }
    
    .paywall-plans { display: flex; gap: 8px; margin-bottom: 20px; }
    .paywall-plan {
      flex: 1;
      padding: 16px 10px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 14px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .paywall-plan.selected { border-color: var(--accent); background: var(--accent-soft); }
    .paywall-plan-badge {
      position: absolute;
      top: -10px; left: 50%; transform: translateX(-50%);
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 4px 10px;
      border-radius: 100px;
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      white-space: nowrap;
    }
    .paywall-plan-period { font-size: 12px; color: var(--text-dim); margin-bottom: 6px; }
    .paywall-plan-price { font-size: 22px; font-weight: 800; }
    .paywall-plan-price span { font-size: 12px; font-weight: 400; color: var(--text-dim); }
    .paywall-plan-savings { font-size: 10px; color: var(--success); font-weight: 600; margin-top: 4px; }
    
    .paywall-cta {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      border-radius: 16px;
      color: #fff;
      font-family: inherit;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 16px;
      transition: transform 0.2s;
    }
    .paywall-cta:active { transform: scale(0.98); }
    .paywall-terms { font-size: 11px; color: var(--text-dimmer); text-align: center; line-height: 1.5; }
    .paywall-terms a { color: var(--accent); text-decoration: none; }
    
    .paywall-restore {
      background: none;
      border: none;
      color: var(--accent);
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      padding: 12px;
      width: 100%;
    }
    
    /* Premium Badge */
    .premium-badge {
      display: inline-flex; align-items: center; gap: 4px;
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
      padding: 4px 10px;
      border-radius: 100px;
      font-size: 10px;
      font-weight: 700;
    }
    .premium-badge svg { width: 12px; height: 12px; }
    
    /* Premium Banner on Dashboard */
    .premium-banner {
      background: linear-gradient(135deg, #FFB347 0%, #FF9F43 100%);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    .premium-banner::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 200px;
      height: 200px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%;
    }
    .premium-banner::after {
      content: '';
      position: absolute;
      bottom: -30%;
      left: -10%;
      width: 150px;
      height: 150px;
      background: rgba(255,255,255,0.05);
      border-radius: 50%;
    }
    .premium-banner-content { position: relative; z-index: 1; }
    .premium-banner-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    .premium-banner-icon {
      width: 36px; height: 36px;
      background: rgba(26, 43, 74, 0.1);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #1a2b4a;
    }
    .premium-banner-icon svg { width: 20px; height: 20px; }
    .premium-banner-title {
      color: #1a2b4a;
      font-size: 18px;
      font-weight: 700;
    }
    .premium-banner-desc {
      color: rgba(26, 43, 74, 0.8);
      font-size: 13px;
      line-height: 1.4;
      margin-bottom: 14px;
    }
    .premium-banner-features {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }
    .premium-banner-feature {
      display: flex;
      align-items: center;
      gap: 4px;
      background: rgba(26, 43, 74, 0.1);
      padding: 6px 10px;
      border-radius: 100px;
      color: #1a2b4a;
      font-size: 11px;
      font-weight: 500;
    }
    .premium-banner-feature svg { width: 12px; height: 12px; }
    .premium-banner-btn {
      width: 100%;
      padding: 14px;
      background: #1a2b4a;
      border: none;
      border-radius: 50px;
      color: #fff;
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .premium-banner-btn:active { transform: scale(0.98); }
    
    .premium-lock {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.6);
      border-radius: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      backdrop-filter: blur(2px);
    }
    .premium-lock svg { width: 24px; height: 24px; margin-bottom: 8px; }
    .premium-lock span { font-size: 12px; font-weight: 600; }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      background: var(--bg-card);
      border-radius: 20px;
      border: 2px dashed var(--border);
    }
    .empty-emoji { margin-bottom: 16px; }
    .empty-emoji svg { width: 56px; height: 56px; }
    .empty-title { font-size: 18px; font-weight: 700; margin-bottom: 8px; }
    .empty-text { font-size: 14px; color: var(--text-dim); line-height: 1.6; }
    
    /* FAB */
    .fab {
      position: fixed;
      bottom: calc(var(--safe-bottom) + 20px);
      left: 50%;
      transform: translateX(-50%);
      display: flex; align-items: center; gap: 8px;
      padding: 14px 24px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border: none;
      border-radius: 14px;
      color: #1a2b4a;
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 6px 24px rgba(255, 159, 67, 0.4);
      transition: all 0.2s ease;
    }
    .fab:hover { transform: translateX(-50%) translateY(-2px); box-shadow: 0 8px 28px rgba(255, 159, 67, 0.5); }
    .fab:active { transform: translateX(-50%) scale(0.97); }
    .fab-icon { display: flex; align-items: center; }
    .fab-icon svg { width: 18px; height: 18px; }
    
    /* ============ NEW GOAL VIEW ============ */
    .new-goal-view { padding: 20px; padding-bottom: calc(var(--safe-bottom) + 24px); min-height: calc(100vh - 65px); display: flex; flex-direction: column; overflow-x: hidden; }
    
    .input-group { margin-bottom: 24px; }
    .input-label { display: block; font-size: 14px; font-weight: 600; color: var(--text-dim); margin-bottom: 10px; }
    .text-input {
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
      padding: 16px 18px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 14px;
      font-family: inherit;
      font-size: 16px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }
    .text-input:focus { border-color: var(--accent); box-shadow: 0 0 0 4px var(--accent-soft); }
    .text-input::placeholder { color: var(--text-dimmer); }
    .text-input[type="date"] {
      min-height: 54px;
    }
    
    .suggestions { margin-top: 8px; }
    .suggestions-label { font-size: 12px; color: var(--text-dimmer); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
    .chips { display: flex; flex-wrap: wrap; gap: 10px; }
    .chip {
      padding: 10px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 100px;
      font-family: inherit;
      font-size: 14px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }
    .chip:active { background: var(--accent-soft); border-color: var(--accent); }
    
    .primary-btn {
      width: 100%;
      padding: 16px 24px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border: none;
      border-radius: 14px;
      color: #1a2b4a;
      font-family: inherit;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      margin-top: auto;
      box-shadow: 0 4px 16px rgba(255, 159, 67, 0.35);
      transition: all 0.2s ease;
    }
    .primary-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(255, 159, 67, 0.4); }
    .primary-btn:active { transform: translateY(0); }
    .primary-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .primary-btn svg { width: 18px; height: 18px; }
    
    .error-msg { color: var(--red); text-align: center; margin-top: 16px; font-size: 14px; }
    
    /* ============ GOAL DETAIL VIEW ============ */
    .detail-view { padding: 16px; padding-bottom: calc(var(--safe-bottom) + 100px); }
    
    .detail-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
    }
    
    .detail-header { display: flex; align-items: flex-start; gap: 14px; margin-bottom: 16px; }
    .detail-icon { 
      width: 48px; height: 48px;
      background: var(--accent-softer);
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
    }
    .detail-icon svg { width: 26px; height: 26px; }
    .detail-info { flex: 1; }
    .detail-name { font-size: 22px; font-weight: 800; margin-bottom: 4px; line-height: 1.2; }
    .detail-meta { font-size: 13px; color: var(--accent); font-weight: 500; }
    
    /* Time Range Display */
    .detail-time-range {
      font-size: 15px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 16px;
    }
    
    /* Option Pills Row */
    .detail-options {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .detail-option-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.2s;
    }
    .detail-option-pill.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
    }
    .detail-option-pill-toggle {
      width: 36px; height: 20px;
      background: var(--border);
      border-radius: 10px;
      position: relative;
      transition: background 0.2s;
    }
    .detail-option-pill.active .detail-option-pill-toggle { background: var(--accent); }
    .detail-option-pill-toggle::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 16px; height: 16px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s;
      box-shadow: 0 1px 2px rgba(0,0,0,0.15);
    }
    .detail-option-pill.active .detail-option-pill-toggle::after { transform: translateX(16px); }
    .detail-option-badge {
      padding: 2px 8px;
      background: var(--accent);
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
      color: #fff;
    }
    
    .detail-progress {
      background: var(--bg);
      border-radius: 14px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .detail-progress-circle { position: relative; width: 56px; height: 56px; flex-shrink: 0; }
    .detail-progress-circle svg { transform: rotate(-90deg); }
    .detail-progress-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; color: var(--accent); }
    .detail-progress-info { flex: 1; }
    .detail-progress-label { font-size: 12px; color: var(--text-dim); margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.3px; }
    .detail-progress-value { font-size: 15px; font-weight: 600; }
    
    /* Section Title for Steps */
    .detail-section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    
    /* Sticky Start Button */
    .detail-sticky-btn {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px 20px;
      padding-bottom: calc(var(--safe-bottom) + 16px);
      background: linear-gradient(180deg, transparent 0%, var(--bg) 20%);
      z-index: 10;
    }
    .detail-sticky-btn .primary-btn {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
    }
    
    .steps-list { display: flex; flex-direction: column; gap: 10px; margin-bottom: 24px; }
    
    .step-item {
      display: flex; 
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .step-item:hover { border-color: var(--accent); }
    .step-item:active { transform: scale(0.99); }
    .step-item.done { background: var(--bg); }
    
    .step-emoji {
      width: 40px; height: 40px;
      background: var(--accent-softer);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
    }
    .step-item.done .step-emoji { opacity: 0.5; }
    
    .step-check {
      width: 24px; height: 24px;
      border: 2px solid var(--border);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      font-size: 12px;
      color: #fff;
      transition: all 0.2s;
      margin-top: 8px;
    }
    .step-check:hover { border-color: var(--success); }
    .step-item.done .step-check { background: var(--success); border-color: var(--success); }
    
    .step-body { flex: 1; min-width: 0; }
    .step-num { font-size: 11px; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; display: none; }
    .step-title { font-size: 15px; font-weight: 600; margin-bottom: 4px; color: var(--text); line-height: 1.3; }
    .step-item.done .step-title { text-decoration: line-through; color: var(--text-dim); }
    .step-desc { font-size: 13px; color: var(--text-dim); line-height: 1.4; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .step-dur { 
      display: inline-flex; 
      align-items: center; 
      gap: 4px; 
      padding: 4px 10px;
      background: var(--bg);
      border-radius: 6px;
      font-size: 12px; 
      font-weight: 500;
      color: var(--text-dim); 
    }
    .step-dur svg { width: 12px; height: 12px; }
    
    .delete-btn {
      width: 100%;
      padding: 14px;
      background: var(--bg-card);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 12px;
      color: var(--red);
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .delete-btn:hover { background: rgba(239, 68, 68, 0.08); border-color: var(--red); }
    
    /* Search Bar */
    .search-bar {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 14px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 16px;
      transition: border-color 0.2s;
    }
    .search-bar:focus-within { border-color: var(--accent); }
    .search-bar svg { width: 18px; height: 18px; color: var(--text-dim); flex-shrink: 0; }
    .search-input {
      flex: 1;
      border: none;
      background: none;
      font-family: inherit;
      font-size: 14px;
      color: var(--text);
      outline: none;
    }
    .search-input::placeholder { color: var(--text-dimmer); }
    .search-clear {
      width: 22px; height: 22px;
      display: flex; align-items: center; justify-content: center;
      background: var(--bg);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: var(--text-dim);
      transition: all 0.2s;
    }
    .search-clear:hover { background: var(--border); }
    .search-clear svg { width: 12px; height: 12px; }
    
    /* Settings Page */
    .settings-view {
      padding: 20px;
      padding-bottom: calc(var(--safe-bottom) + 24px);
    }
    .settings-section {
      margin-bottom: 28px;
    }
    .settings-section-title {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }
    .settings-card {
      background: var(--bg-card);
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .settings-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 18px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
    }
    .settings-item:last-child { border-bottom: none; }
    .settings-item:active { background: var(--bg); }
    .settings-item-icon {
      width: 36px; height: 36px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 10px;
      flex-shrink: 0;
    }
    .settings-item-icon svg { width: 20px; height: 20px; }
    .settings-item-content { flex: 1; }
    .settings-item-title { font-size: 15px; font-weight: 500; color: var(--text); }
    .settings-item-desc { font-size: 13px; color: var(--text-dim); margin-top: 2px; }
    .settings-item-arrow { color: var(--text-dimmer); }
    .settings-item-arrow svg { width: 18px; height: 18px; }
    .settings-item-toggle {
      width: 50px; height: 28px;
      background: var(--border);
      border-radius: 14px;
      position: relative;
      transition: background 0.2s;
    }
    .settings-item-toggle.active { background: var(--accent); }
    .settings-item-toggle::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 24px; height: 24px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .settings-item-toggle.active::after { transform: translateX(22px); }
    
    .settings-danger {
      color: var(--red);
    }
    .settings-danger .settings-item-title { color: var(--red); }
    
    /* Edit Modal */
    .edit-modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex; align-items: flex-end; justify-content: center;
      z-index: 100;
      padding: 0;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    .edit-modal-content {
      background: var(--bg-card);
      border-radius: 24px 24px 0 0;
      padding: 20px;
      padding-bottom: calc(var(--safe-bottom) + 20px);
      width: 100%;
      max-width: 480px;
      max-height: 85vh;
      overflow-y: auto;
      animation: slideUpModal 0.3s ease;
    }
    @keyframes slideUpModal { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .edit-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    .edit-modal-title {
      font-size: 18px;
      font-weight: 700;
    }
    .edit-modal-delete {
      padding: 8px 14px;
      background: rgba(239, 68, 68, 0.1);
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: var(--red);
      cursor: pointer;
    }
    .edit-modal-close {
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      background: var(--bg);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: var(--text-dim);
    }
    .edit-modal-close svg { width: 18px; height: 18px; }
    .edit-field { margin-bottom: 20px; }
    .edit-label { display: block; font-size: 13px; font-weight: 600; color: var(--text-dim); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.3px; }
    .edit-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 15px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }
    .edit-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-softer); }
    .edit-input-char-count {
      text-align: right;
      font-size: 12px;
      color: var(--text-dimmer);
      margin-top: 6px;
    }
    .edit-textarea {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 15px;
      color: var(--text);
      outline: none;
      resize: vertical;
      min-height: 80px;
      transition: border-color 0.2s;
    }
    .edit-textarea:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-softer); }
    
    /* Time Picker Pills */
    .edit-time-pills {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .edit-time-pill {
      padding: 10px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }
    .edit-time-pill:hover { border-color: var(--accent); }
    .edit-time-pill.selected {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
      font-weight: 600;
    }
    .edit-time-divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 16px 0;
      color: var(--text-dimmer);
      font-size: 13px;
    }
    .edit-time-divider::before,
    .edit-time-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }
    .edit-toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg);
      border-radius: 12px;
    }
    .edit-toggle-label { font-size: 14px; color: var(--text); }
    .edit-toggle {
      width: 48px; height: 28px;
      background: var(--border);
      border-radius: 14px;
      position: relative;
      cursor: pointer;
      transition: background 0.2s;
    }
    .edit-toggle.active { background: var(--accent); }
    .edit-toggle::after {
      content: '';
      position: absolute;
      top: 2px; left: 2px;
      width: 24px; height: 24px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }
    .edit-toggle.active::after { transform: translateX(20px); }
    
    .edit-actions {
      display: flex;
      gap: 12px;
      margin-top: 28px;
    }
    .edit-btn-cancel {
      flex: 1;
      padding: 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      transition: background 0.2s;
    }
    .edit-btn-cancel:hover { background: var(--border); }
    .edit-btn-save {
      flex: 2;
      padding: 16px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border: none;
      border-radius: 14px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 600;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(255, 159, 67, 0.3);
      transition: all 0.2s;
    }
    .edit-btn-save:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(255, 159, 67, 0.4); }
    
    /* Due Date Badge */
    .due-date-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--orange-soft);
      border-radius: 100px;
      font-size: 12px;
      font-weight: 500;
      color: var(--orange);
      margin-top: 8px;
    }
    .due-date-badge svg { width: 14px; height: 14px; }
    .due-date-badge.overdue { background: rgba(239,68,68,0.1); color: var(--red); }
    .due-date-badge.soon { background: var(--gold-soft); color: #b45309; }
    
    /* Goal Actions */
    .goal-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }
    .goal-action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
    }
    .goal-action-btn svg { width: 18px; height: 18px; }
    .goal-action-btn:active { background: var(--border); }
    
    /* Map Link Button */
    .map-link-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 500;
      color: var(--accent);
      cursor: pointer;
      margin-top: 8px;
      margin-right: 6px;
      text-decoration: none;
      transition: all 0.2s;
    }
    .map-link-btn:hover { background: var(--accent-softer); border-color: var(--accent); }
    .map-link-btn svg { width: 12px; height: 12px; }
    
    /* Location Badge */
    .location-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--success-soft);
      border-radius: 100px;
      font-size: 13px;
      font-weight: 500;
      color: var(--success);
    }
    .location-badge svg { width: 14px; height: 14px; }
    
    /* Expand Button */
    .expand-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 500;
      color: var(--purple);
      cursor: pointer;
      margin-top: 8px;
      margin-right: 6px;
      transition: all 0.2s;
    }
    .expand-btn:hover { background: var(--purple-soft); border-color: var(--purple); }
    .expand-btn svg { width: 12px; height: 12px; }
    .expand-btn.view { background: var(--accent-softer); border-color: var(--accent); color: var(--accent); }
    .expand-btn.view:hover { background: var(--accent-soft); }
    
    /* Expand Modal */
    .expand-modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      z-index: 100;
      padding: 16px;
    }
    .expand-modal-content {
      background: var(--bg-card);
      border-radius: 24px;
      width: 100%;
      max-width: 480px;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .expand-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }
    .expand-modal-title {
      font-size: 18px;
      font-weight: 700;
      flex: 1;
      padding-right: 16px;
    }
    .expand-modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 20px 24px;
    }
    .expand-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
    }
    
    /* Expand Content Styles */
    .expand-section {
      margin-bottom: 24px;
    }
    .expand-section:last-child { margin-bottom: 0; }
    .expand-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .expand-section-title svg { width: 16px; height: 16px; }
    
    .expand-text {
      font-size: 15px;
      line-height: 1.6;
      color: var(--text);
    }
    
    .expand-resource {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 14px;
      background: var(--bg);
      border-radius: 12px;
      margin-bottom: 10px;
      text-decoration: none;
      transition: all 0.2s;
    }
    .expand-resource:hover { background: var(--border); }
    .expand-resource:last-child { margin-bottom: 0; }
    .expand-resource-icon {
      width: 40px; height: 40px;
      background: var(--accent-soft);
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      color: var(--accent);
      flex-shrink: 0;
    }
    .expand-resource-icon svg { width: 20px; height: 20px; }
    .expand-resource-info { flex: 1; }
    .expand-resource-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 4px;
    }
    .expand-resource-desc {
      font-size: 13px;
      color: var(--text-dim);
      line-height: 1.4;
    }
    .expand-resource-meta {
      font-size: 12px;
      color: var(--accent);
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .expand-tip {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 14px;
      background: var(--gold-soft);
      border-radius: 12px;
      margin-bottom: 10px;
    }
    .expand-tip:last-child { margin-bottom: 0; }
    .expand-tip-icon {
      color: var(--gold);
      flex-shrink: 0;
    }
    .expand-tip-icon svg { width: 18px; height: 18px; }
    .expand-tip-text {
      font-size: 14px;
      color: var(--text);
      line-height: 1.5;
    }
    
    .expand-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }
    .expand-loading-spinner {
      font-size: 32px;
      color: var(--accent);
      margin-bottom: 16px;
    }
    .expand-loading-text {
      font-size: 15px;
      color: var(--text-dim);
    }
    
    /* Analytics Dashboard */
    .analytics-view {
      padding: 20px;
      padding-bottom: calc(var(--safe-bottom) + 24px);
    }
    
    .analytics-header {
      margin-bottom: 24px;
    }
    .analytics-title {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .analytics-subtitle {
      font-size: 14px;
      color: var(--text-dim);
    }
    
    /* Filter Tabs */
    .analytics-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      background: var(--bg-card);
      padding: 6px;
      border-radius: 14px;
      border: 1px solid var(--border);
    }
    .analytics-tab {
      flex: 1;
      padding: 12px 16px;
      background: none;
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-dim);
      cursor: pointer;
      transition: all 0.2s;
    }
    .analytics-tab.active {
      background: var(--accent);
      color: #fff;
    }
    
    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-bottom: 24px;
    }
    .stat-card {
      background: var(--bg-card);
      border-radius: 18px;
      padding: 18px;
      border: 1px solid var(--border);
    }
    .stat-card.wide {
      grid-column: span 2;
    }
    .stat-icon {
      width: 40px; height: 40px;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 14px;
    }
    .stat-icon svg { width: 20px; height: 20px; }
    .stat-value {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .stat-label {
      font-size: 13px;
      color: var(--text-dim);
    }
    .stat-change {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      font-weight: 600;
      margin-top: 8px;
      padding: 4px 8px;
      border-radius: 6px;
    }
    .stat-change.positive { background: var(--success-soft); color: var(--success); }
    .stat-change.neutral { background: var(--border); color: var(--text-dim); }
    .stat-change svg { width: 12px; height: 12px; }
    
    /* Progress Chart */
    .chart-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid var(--border);
      margin-bottom: 24px;
    }
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .chart-title {
      font-size: 16px;
      font-weight: 700;
    }
    .chart-period {
      font-size: 13px;
      color: var(--text-dim);
    }
    .chart-bars {
      display: flex;
      align-items: flex-end;
      gap: 8px;
      height: 120px;
      padding-top: 10px;
    }
    .chart-bar-wrap {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .chart-bar {
      width: 100%;
      max-width: 40px;
      background: var(--accent);
      border-radius: 6px 6px 0 0;
      transition: height 0.5s ease;
      min-height: 4px;
    }
    .chart-bar-label {
      font-size: 11px;
      color: var(--text-dim);
      font-weight: 500;
    }
    
    /* Completed Goals List */
    .completed-section {
      margin-bottom: 24px;
    }
    .completed-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
    }
    .completed-title {
      font-size: 18px;
      font-weight: 700;
    }
    .completed-count {
      font-size: 13px;
      color: var(--text-dim);
      background: var(--border);
      padding: 4px 10px;
      border-radius: 100px;
    }
    .completed-goal {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: var(--bg-card);
      border-radius: 16px;
      border: 1px solid var(--border);
      margin-bottom: 10px;
    }
    .completed-goal-icon {
      width: 44px; height: 44px;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    .completed-goal-icon svg { width: 22px; height: 22px; }
    .completed-goal-info { flex: 1; }
    .completed-goal-name {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .completed-goal-meta {
      font-size: 13px;
      color: var(--text-dim);
    }
    .completed-goal-badge {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      background: var(--success-soft);
      border-radius: 8px;
      color: var(--success);
      font-size: 12px;
      font-weight: 600;
    }
    .completed-goal-badge svg { width: 14px; height: 14px; }
    
    /* Empty Analytics */
    .analytics-empty {
      text-align: center;
      padding: 60px 24px;
    }
    .analytics-empty-icon {
      width: 80px; height: 80px;
      background: var(--accent-soft);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px;
      color: var(--accent);
    }
    .analytics-empty-icon svg { width: 40px; height: 40px; }
    .analytics-empty-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    .analytics-empty-text {
      font-size: 15px;
      color: var(--text-dim);
      line-height: 1.5;
    }
    
    /* Gamification */
    .level-card {
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      border-radius: 20px;
      padding: 20px;
      color: #fff;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .level-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    }
    .level-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      position: relative;
    }
    .level-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .level-badge {
      width: 48px; height: 48px;
      background: rgba(255,255,255,0.2);
      border-radius: 14px;
      display: flex; align-items: center; justify-content: center;
    }
    .level-badge svg { width: 26px; height: 26px; }
    .level-number {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 2px;
    }
    .level-title {
      font-size: 20px;
      font-weight: 700;
    }
    .level-points {
      text-align: right;
    }
    .level-points-value {
      font-size: 24px;
      font-weight: 800;
    }
    .level-points-label {
      font-size: 12px;
      opacity: 0.8;
    }
    .level-progress {
      position: relative;
    }
    .level-progress-bar {
      height: 8px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      overflow: hidden;
    }
    .level-progress-fill {
      height: 100%;
      background: #fff;
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    .level-progress-text {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 12px;
      opacity: 0.8;
    }
    
    /* Points Animation */
    @keyframes pointsFloat {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-30px); }
    }
    .points-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--gold);
      color: #000;
      padding: 12px 24px;
      border-radius: 100px;
      font-size: 18px;
      font-weight: 700;
      z-index: 1000;
      animation: pointsFloat 1.5s ease-out forwards;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .points-popup svg { width: 20px; height: 20px; }
    
    /* Streak Card */
    .streak-card {
      background: var(--bg-card);
      border-radius: 18px;
      padding: 18px;
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .streak-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    .streak-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .streak-icon {
      width: 44px; height: 44px;
      background: var(--orange-soft);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      color: var(--orange);
    }
    .streak-icon svg { width: 22px; height: 22px; }
    .streak-label {
      font-size: 13px;
      color: var(--text-dim);
      margin-bottom: 2px;
    }
    .streak-value {
      font-size: 20px;
      font-weight: 700;
    }
    .streak-best {
      text-align: right;
    }
    .streak-best-label {
      font-size: 12px;
      color: var(--text-dim);
    }
    .streak-best-value {
      font-size: 16px;
      font-weight: 700;
      color: var(--gold);
    }
    .streak-days {
      display: flex;
      gap: 6px;
    }
    .streak-day {
      flex: 1;
      height: 8px;
      background: var(--border);
      border-radius: 4px;
    }
    .streak-day.active {
      background: var(--orange);
    }
    .streak-day.today {
      background: var(--accent);
    }
    
    /* Level Up Modal */
    .levelup-modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex; align-items: center; justify-content: center;
      z-index: 200;
      padding: 24px;
    }
    .levelup-card {
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      border-radius: 28px;
      padding: 48px 32px;
      text-align: center;
      color: #fff;
      max-width: 320px;
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    .levelup-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    .levelup-icon {
      width: 80px; height: 80px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 24px;
      position: relative;
    }
    .levelup-icon svg { width: 40px; height: 40px; }
    .levelup-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 8px;
      position: relative;
    }
    .levelup-level {
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 24px;
      position: relative;
    }
    .levelup-rewards {
      background: rgba(255,255,255,0.1);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 24px;
      position: relative;
    }
    .levelup-reward {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 15px;
    }
    .levelup-btn {
      padding: 16px 32px;
      background: #fff;
      border: none;
      border-radius: 14px;
      color: var(--accent);
      font-family: inherit;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
    }
    
    /* Daily Bonus Card */
    .daily-bonus-card {
      background: linear-gradient(135deg, var(--gold) 0%, #f59e0b 100%);
      border-radius: 16px;
      padding: 16px;
      color: #000;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      cursor: pointer;
    }
    .daily-bonus-icon {
      width: 44px; height: 44px;
      background: rgba(255,255,255,0.3);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    .daily-bonus-icon svg { width: 22px; height: 22px; }
    .daily-bonus-info { flex: 1; }
    .daily-bonus-title {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 2px;
    }
    .daily-bonus-desc {
      font-size: 13px;
      opacity: 0.8;
    }
    .daily-bonus-btn {
      padding: 10px 18px;
      background: #000;
      border: none;
      border-radius: 10px;
      color: var(--gold);
      font-family: inherit;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Error Tracking */
    .error-log-view {
      padding: 20px;
      padding-bottom: calc(var(--safe-bottom) + 24px);
    }
    
    .error-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    .error-stat {
      background: var(--bg-card);
      border-radius: 14px;
      padding: 16px;
      text-align: center;
      border: 1px solid var(--border);
    }
    .error-stat-value {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 4px;
    }
    .error-stat-value.errors { color: var(--red); }
    .error-stat-value.warnings { color: var(--orange); }
    .error-stat-value.healthy { color: var(--success); }
    .error-stat-label {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .error-filters {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .error-filter {
      padding: 8px 14px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 100px;
      font-family: inherit;
      font-size: 13px;
      color: var(--text-dim);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .error-filter.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    .error-filter-count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 18px;
      height: 18px;
      background: rgba(0,0,0,0.2);
      border-radius: 100px;
      font-size: 11px;
      margin-left: 6px;
      padding: 0 5px;
    }
    .error-filter.active .error-filter-count {
      background: rgba(255,255,255,0.3);
    }
    
    .error-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .error-item {
      background: var(--bg-card);
      border-radius: 14px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .error-item-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 16px;
      cursor: pointer;
    }
    .error-item-icon {
      width: 36px; height: 36px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .error-item-icon.error { background: rgba(239,68,68,0.1); color: var(--red); }
    .error-item-icon.warning { background: var(--orange-soft); color: var(--orange); }
    .error-item-icon.info { background: var(--accent-soft); color: var(--accent); }
    .error-item-icon svg { width: 18px; height: 18px; }
    .error-item-content { flex: 1; min-width: 0; }
    .error-item-message {
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 4px;
      word-break: break-word;
    }
    .error-item-meta {
      font-size: 12px;
      color: var(--text-dim);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .error-item-time {
      color: var(--text-dimmer);
    }
    .error-item-expand {
      color: var(--text-dim);
      padding: 4px;
    }
    .error-item-expand svg { width: 16px; height: 16px; transition: transform 0.2s; }
    .error-item-expand.open svg { transform: rotate(180deg); }
    
    .error-item-details {
      padding: 0 16px 16px;
      border-top: 1px solid var(--border);
      margin-top: 0;
    }
    .error-detail-section {
      margin-top: 12px;
    }
    .error-detail-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }
    .error-detail-code {
      background: var(--bg);
      border-radius: 8px;
      padding: 12px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      font-size: 12px;
      color: var(--text);
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .error-copy-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: inherit;
      font-size: 13px;
      color: var(--text-dim);
      cursor: pointer;
      margin-top: 12px;
    }
    .error-copy-btn svg { width: 14px; height: 14px; }
    
    .error-empty {
      text-align: center;
      padding: 60px 24px;
    }
    .error-empty-icon {
      width: 80px; height: 80px;
      background: var(--success-soft);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px;
      color: var(--success);
    }
    .error-empty-icon svg { width: 40px; height: 40px; }
    .error-empty-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--success);
    }
    .error-empty-text {
      font-size: 15px;
      color: var(--text-dim);
    }
    
    .error-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    .error-action-btn {
      flex: 1;
      padding: 14px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .error-action-btn svg { width: 18px; height: 18px; }
    .error-action-btn.danger { color: var(--red); }
    
    /* Do It For Me Feature */
    .doitforme-btn {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 6px 12px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border: none;
      border-radius: 8px;
      font-family: inherit;
      font-size: 12px;
      font-weight: 600;
      color: #1a2b4a;
      cursor: pointer;
      margin-top: 8px;
      margin-right: 6px;
      transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(255, 159, 67, 0.25);
    }
    .doitforme-btn:hover { transform: translateY(-1px); box-shadow: 0 3px 10px rgba(255, 159, 67, 0.35); }
    .doitforme-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .doitforme-btn svg { width: 12px; height: 12px; }
    .doitforme-btn.done {
      background: linear-gradient(135deg, var(--success) 0%, #34D399 100%);
      color: #fff;
      box-shadow: 0 2px 6px rgba(34, 197, 94, 0.25);
    }
    
    /* Do It For Me Modal */
    .doitforme-modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center;
      z-index: 100;
      padding: 16px;
    }
    .doitforme-modal-content {
      background: var(--bg-card);
      border-radius: 24px;
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .doitforme-modal-header {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, var(--accent) 0%, var(--purple) 100%);
      color: #fff;
    }
    .doitforme-modal-icon {
      width: 44px; height: 44px;
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    .doitforme-modal-icon svg { width: 22px; height: 22px; }
    .doitforme-modal-title {
      font-size: 18px;
      font-weight: 700;
    }
    .doitforme-modal-subtitle {
      font-size: 13px;
      opacity: 0.9;
    }
    .doitforme-modal-close {
      margin-left: auto;
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: #fff;
    }
    .doitforme-modal-close svg { width: 18px; height: 18px; }
    
    .doitforme-modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }
    
    .doitforme-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 20px;
      text-align: center;
    }
    .doitforme-loading-icon {
      width: 64px; height: 64px;
      background: linear-gradient(135deg, var(--accent-soft) 0%, var(--purple-soft) 100%);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 20px;
      color: var(--accent);
    }
    .doitforme-loading-icon svg { width: 32px; height: 32px; }
    .doitforme-loading-text {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 8px;
    }
    .doitforme-loading-subtext {
      font-size: 14px;
      color: var(--text-dim);
    }
    
    .doitforme-result {
      background: var(--bg);
      border-radius: 16px;
      padding: 20px;
      font-size: 14px;
      line-height: 1.7;
      color: var(--text);
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .doitforme-result h1, .doitforme-result h2, .doitforme-result h3 {
      font-size: 16px;
      font-weight: 700;
      margin: 16px 0 8px;
      color: var(--text);
    }
    .doitforme-result h1:first-child, .doitforme-result h2:first-child, .doitforme-result h3:first-child {
      margin-top: 0;
    }
    .doitforme-result ul, .doitforme-result ol {
      padding-left: 20px;
      margin: 8px 0;
    }
    .doitforme-result li {
      margin: 6px 0;
    }
    .doitforme-result strong {
      font-weight: 600;
      color: var(--accent);
    }
    .doitforme-result table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      font-size: 13px;
    }
    .doitforme-result th, .doitforme-result td {
      border: 1px solid var(--border);
      padding: 8px 10px;
      text-align: left;
    }
    .doitforme-result th {
      background: var(--bg-card);
      font-weight: 600;
    }
    
    .doitforme-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
    }
    .doitforme-action-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      cursor: pointer;
    }
    .doitforme-action-btn svg { width: 18px; height: 18px; }
    .doitforme-action-btn.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }
    
    /* Saved indicator */
    .doitforme-saved-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      background: var(--success-soft);
      border-radius: 100px;
      font-size: 12px;
      font-weight: 500;
      color: var(--success);
      margin-bottom: 12px;
    }
    .doitforme-saved-badge svg { width: 12px; height: 12px; }
    
    /* Talk to Aclio Button */
    .aclio-chat-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border: none;
      border-radius: 10px;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      color: #1a2b4a;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 8px rgba(255, 159, 67, 0.25);
    }
    .aclio-chat-btn:hover { transform: translateY(-1px); box-shadow: 0 3px 12px rgba(255, 159, 67, 0.35); }
    .aclio-chat-btn svg { width: 14px; height: 14px; }
    
    /* Talk to Aclio Chat Modal */
    .aclio-chat-modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex; align-items: flex-end; justify-content: center;
      z-index: 100;
      padding: 0;
    }
    .aclio-chat-content {
      background: var(--bg-card);
      border-radius: 24px 24px 0 0;
      width: 100%;
      max-width: 480px;
      height: 85vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .aclio-chat-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      color: #fff;
    }
    .aclio-chat-avatar {
      width: 44px; height: 44px;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
    }
    .aclio-chat-title { font-size: 18px; font-weight: 700; }
    .aclio-chat-subtitle { font-size: 13px; opacity: 0.9; }
    .aclio-chat-close {
      margin-left: auto;
      width: 32px; height: 32px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      color: #fff;
    }
    .aclio-chat-close svg { width: 18px; height: 18px; }
    
    .aclio-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .aclio-message {
      display: flex;
      gap: 10px;
      max-width: 85%;
    }
    .aclio-message.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }
    .aclio-message.assistant { align-self: flex-start; }
    .aclio-message-avatar {
      width: 32px; height: 32px;
      background: var(--accent-soft);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    .aclio-message-bubble {
      padding: 12px 16px;
      border-radius: 18px;
      font-size: 15px;
      line-height: 1.5;
    }
    .aclio-message.assistant .aclio-message-bubble {
      background: var(--bg);
      border-bottom-left-radius: 4px;
    }
    .aclio-message.user .aclio-message-bubble {
      background: var(--accent);
      color: #fff;
      border-bottom-right-radius: 4px;
    }
    
    .aclio-typing span {
      animation: typing 1.4s infinite;
    }
    .aclio-typing span:nth-child(2) { animation-delay: 0.2s; }
    .aclio-typing span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing {
      0%, 60%, 100% { opacity: 0.3; }
      30% { opacity: 1; }
    }
    
    .aclio-chat-input-container {
      display: flex;
      gap: 10px;
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      background: var(--bg);
    }
    .aclio-chat-input {
      flex: 1;
      padding: 12px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 24px;
      font-family: inherit;
      font-size: 15px;
      color: var(--text);
      outline: none;
    }
    .aclio-chat-input:focus { border-color: var(--accent); }
    .aclio-chat-send {
      width: 44px; height: 44px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .aclio-chat-send:hover { transform: scale(1.05); }
    .aclio-chat-send:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .aclio-chat-send svg { width: 20px; height: 20px; }
    
    .aclio-quick-prompts {
      display: flex;
      gap: 8px;
      padding: 0 16px 16px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    .aclio-quick-prompts button {
      flex-shrink: 0;
      padding: 8px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 100px;
      font-family: inherit;
      font-size: 13px;
      color: var(--text-dim);
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .aclio-quick-prompts button:hover {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
    }
    
    /* Goal Questions */
    .questions-section {
      background: var(--bg-card);
      border-radius: 18px;
      border: 1px solid var(--border);
      padding: 20px;
      margin-bottom: 24px;
    }
    .questions-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }
    .questions-icon {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, var(--accent-soft) 0%, var(--purple-soft) 100%);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      color: var(--accent);
    }
    .questions-icon svg { width: 20px; height: 20px; }
    .questions-title {
      font-size: 16px;
      font-weight: 700;
    }
    .questions-subtitle {
      font-size: 13px;
      color: var(--text-dim);
    }
    
    .question-item {
      margin-bottom: 16px;
    }
    .question-item:last-child { margin-bottom: 0; }
    .question-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 8px;
    }
    .question-number {
      width: 22px; height: 22px;
      background: var(--accent);
      color: #fff;
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px;
      font-weight: 600;
      flex-shrink: 0;
    }
    .question-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 15px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }
    .question-input:focus { border-color: var(--accent); }
    .question-input::placeholder { color: var(--text-dimmer); }
    
    .questions-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 30px;
      color: var(--text-dim);
      font-size: 14px;
    }
    
    .questions-generate-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, var(--accent-soft) 0%, var(--purple-soft) 100%);
      border: 2px dashed var(--accent);
      border-radius: 14px;
      font-family: inherit;
      font-size: 15px;
      font-weight: 500;
      color: var(--accent);
      cursor: pointer;
      margin-bottom: 24px;
      transition: all 0.2s;
    }
    .questions-generate-btn:hover { background: var(--accent); color: #fff; border-style: solid; }
    .questions-generate-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .questions-generate-btn svg { width: 20px; height: 20px; }
    
    .questions-skip {
      text-align: center;
      margin-top: 12px;
    }
    .questions-skip-btn {
      background: none;
      border: none;
      font-family: inherit;
      font-size: 14px;
      color: var(--text-dim);
      cursor: pointer;
      text-decoration: underline;
    }
    
    /* Celebration Modal */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex; align-items: center; justify-content: center;
      padding: 24px;
      z-index: 100;
    }
    .modal-card {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
      border-radius: 28px;
      padding: 40px 32px;
      text-align: center;
      color: #fff;
      max-width: 320px;
      width: 100%;
    }
    .modal-emoji { margin-bottom: 20px; }
    .modal-emoji svg { width: 64px; height: 64px; }
    .modal-title { font-size: 26px; font-weight: 800; margin-bottom: 8px; }
    .modal-text { font-size: 15px; opacity: 0.9; margin-bottom: 28px; }
    .modal-btn {
      padding: 16px 32px;
      background: #fff;
      border: none;
      border-radius: 14px;
      color: var(--accent);
      font-family: inherit;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Welcome Screen - Aclio Style */
    .welcome-screen {
      width: 100%;
      height: 100%;
      display: flex; 
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0 24px;
      background: linear-gradient(180deg, #e8f4fc 0%, #d4ebf7 50%, #c5e3f3 100%);
      box-sizing: border-box;
      overflow: hidden;
      touch-action: none;
      -webkit-overflow-scrolling: none;
    }
    .welcome-content { 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center;
    }
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-12px); }
    }
    .welcome-mascot {
      width: 260px;
      height: 260px;
      margin-bottom: -10px;
      position: relative;
      filter: drop-shadow(0 20px 40px rgba(255, 140, 66, 0.3));
      animation: float 3s ease-in-out infinite;
    }
    .welcome-mascot img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .welcome-title { 
      font-size: 48px; 
      font-weight: 800; 
      margin-bottom: 4px; 
      color: #1a2b4a;
      letter-spacing: -1px;
    }
    .welcome-tagline { 
      font-size: 20px; 
      color: #4a5568;
      font-weight: 400;
    }
    .welcome-bottom { 
      position: absolute;
      bottom: calc(env(safe-area-inset-bottom, 0) + 24px);
      left: 24px;
      right: 24px;
      text-align: center;
    }
    .welcome-btn {
      width: 100%;
      padding: 18px 32px;
      background: linear-gradient(135deg, #FFB347 0%, #FF9F43 100%);
      border: none;
      border-radius: 50px;
      color: #1a2b4a;
      font-family: inherit;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(255, 159, 67, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .welcome-btn:active { 
      transform: scale(0.98); 
      box-shadow: 0 4px 20px rgba(255, 159, 67, 0.3);
    }
    .welcome-signin { 
      margin-top: 20px; 
      font-size: 15px; 
      color: #4a5568; 
    }
    .welcome-signin button { 
      background: none; 
      border: none; 
      color: #1a2b4a; 
      font-weight: 600; 
      cursor: pointer; 
      font-size: 15px;
      text-decoration: underline;
    }
    
    /* Shared Button Style - Aclio Orange */
    .onboarding-btn { 
      width: 100%;
      padding: 18px; 
      background: linear-gradient(135deg, #FFB347 0%, #FF9F43 100%);
      border: none; 
      border-radius: 50px; 
      color: #1a2b4a; 
      font-family: inherit; 
      font-size: 17px; 
      font-weight: 700; 
      cursor: pointer; 
      box-shadow: 0 8px 30px rgba(255, 159, 67, 0.4);
      transition: transform 0.2s;
    }
    .onboarding-btn:active { transform: scale(0.98); }
    .onboarding-btn:disabled { opacity: 0.5; }

    /* Onboarding - Aclio Style */
    .onboarding {
      width: 100%;
      height: 100%;
      min-height: 100vh; min-height: 100dvh;
      display: flex; flex-direction: column;
      padding-top: calc(env(safe-area-inset-top, 0) + 20px);
      background: linear-gradient(180deg, #e8f4fc 0%, #d4ebf7 50%, #c5e3f3 100%);
      box-sizing: border-box;
      overflow: hidden;
    }
    
    .onboarding-skip-top {
      position: absolute;
      top: calc(env(safe-area-inset-top, 0) + 20px);
      right: 24px;
      background: none;
      border: none;
      z-index: 10;
      color: #FF9F43;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      z-index: 10;
    }
    
    .onboarding-content { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center;
      padding: 24px;
      text-align: center;
      overflow-y: auto;
      min-height: 0;
    }
    
    /* Illustration */
    .onboarding-illustration {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 32px;
    }
    
    .onboarding-blob {
      width: 180px; 
      height: 180px;
      background: linear-gradient(135deg, rgba(255, 179, 71, 0.2) 0%, rgba(255, 159, 67, 0.1) 100%);
      border-radius: 50%;
      position: relative;
      animation: float 3s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-12px); }
    }
    
    .onboarding-image-container {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .onboarding-image {
      width: 90px;
      height: 90px;
      object-fit: contain;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.1));
    }
    
    .onboarding-icon-badge {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 56px; 
      height: 56px;
      border-radius: 16px;
      display: flex; 
      align-items: center; 
      justify-content: center;
      background: var(--bg-card);
      box-shadow: var(--shadow-md);
      z-index: 2;
    }
    .onboarding-icon-badge svg { width: 26px; height: 26px; }
    
    /* Typography - Aclio Style */
    .onboarding-title { 
      font-size: 26px; 
      font-weight: 700; 
      color: #1a2b4a;
      margin-bottom: 16px; 
      line-height: 1.2; 
    }
    
    .onboarding-text { 
      font-size: 16px; 
      font-weight: 400;
      color: #4a5568; 
      line-height: 1.5; 
      margin-bottom: 28px; 
      max-width: 85%;
    }
    
    /* Screen 1: Feature List */
    .onboarding-features {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 280px;
    }
    
    .onboarding-feature-item {
      display: flex; 
      align-items: center; 
      gap: 12px;
      padding: 14px 18px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 14px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
      box-shadow: var(--shadow-md);
    }
    .onboarding-feature-icon { color: #FF9F43; display: flex; flex-shrink: 0; }
    .onboarding-feature-icon svg { width: 18px; height: 18px; }
    
    /* Screen 2: Task Cards */
    .onboarding-task-list {
      width: 100%;
      max-width: 320px;
      display: flex; 
      flex-direction: column; 
      gap: 12px;
    }
    
    .onboarding-task-card {
      display: flex; 
      align-items: center; 
      gap: 14px;
      padding: 16px 18px;
      background: var(--bg-card);
      border-radius: 14px;
      font-size: 15px;
      color: var(--text);
      text-align: left;
      box-shadow: var(--shadow-md);
    }
    
    .onboarding-task-card.completed {
      background: var(--success-soft);
    }
    
    .onboarding-task-icon {
      width: 24px; 
      height: 24px;
      border-radius: 50%;
      display: flex; 
      align-items: center; 
      justify-content: center;
      flex-shrink: 0;
    }
    
    .onboarding-task-card.completed .onboarding-task-icon { 
      background: var(--success); 
      color: #fff;
    }
    .onboarding-task-icon svg { width: 14px; height: 14px; }
    
    .onboarding-task-bullet {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border);
      border-radius: 50%;
    }
    
    .task-done { 
      text-decoration: line-through; 
      color: var(--text-dim);
    }
    
    /* Screen 3: Achievement Badge */
    .onboarding-badge {
      display: inline-flex; 
      align-items: center; 
      gap: 10px;
      padding: 12px 20px;
      background: var(--gold-soft);
      border-radius: 100px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text);
    }
    .onboarding-badge-icon { color: var(--gold); display: flex; }
    .onboarding-badge-icon svg { width: 18px; height: 18px; }
    
    /* Footer */
    .onboarding-footer { 
      padding: 20px 24px calc(env(safe-area-inset-bottom, 0) + 24px);
      flex-shrink: 0;
    }
    
    /* Progress Dots - Aclio Orange */
    .onboarding-dots { 
      display: flex; 
      justify-content: center; 
      gap: 8px; 
      margin-bottom: 20px; 
    }
    
    .onboarding-dot { 
      width: 8px; 
      height: 8px; 
      border-radius: 50%; 
      background: rgba(255, 159, 67, 0.3); 
      transition: all 0.3s ease;
    }
    
    .onboarding-dot.active { 
      width: 24px; 
      border-radius: 4px; 
      background: #FF9F43; 
    }
    
    /* CTA Button - Aclio Orange */
    .onboarding-cta { 
      width: 100%;
      padding: 18px; 
      background: linear-gradient(135deg, #FFB347 0%, #FF9F43 100%);
      border: none; 
      border-radius: 50px; 
      color: #1a2b4a; 
      font-family: inherit; 
      font-size: 17px; 
      font-weight: 700; 
      cursor: pointer; 
      box-shadow: 0 8px 30px rgba(255, 159, 67, 0.4);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .onboarding-cta:active { 
      transform: scale(0.98); 
    }
    .onboarding-cta:disabled { opacity: 0.5; }

    /* Profile Setup - Aclio Style */
    .profile-setup {
      width: 100%;
      height: 100%;
      min-height: 100vh; min-height: 100dvh;
      display: flex; flex-direction: column;
      padding: calc(var(--safe-top) + 20px) 24px calc(var(--safe-bottom) + 24px);
      background: linear-gradient(180deg, #e8f4fc 0%, #d4ebf7 50%, #c5e3f3 100%);
      box-sizing: border-box;
      overflow-y: auto;
    }
    .profile-header { margin-top: 40px; margin-bottom: 32px; text-align: center; }
    .profile-title { font-size: 26px; font-weight: 700; margin-bottom: 8px; color: #1a2b4a; }
    .profile-subtitle { font-size: 16px; color: #4a5568; }
    
    .profile-form { flex: 1; }
    .profile-field { margin-bottom: 24px; }
    .profile-label { display: block; font-size: 14px; font-weight: 600; color: var(--text-dim); margin-bottom: 10px; }
    .profile-input {
      width: 100%;
      padding: 18px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 14px;
      font-family: inherit;
      font-size: 16px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      box-shadow: var(--shadow-md);
    }
    .profile-input:focus { border-color: #FF9F43; box-shadow: 0 0 0 4px rgba(255, 159, 67, 0.15); }
    .profile-input::placeholder { color: var(--text-dimmer); }
    
    .profile-gender-options { display: flex; gap: 10px; }
    .profile-gender-btn {
      flex: 1;
      padding: 14px;
      background: var(--bg-card);
      border: 2px solid var(--border);
      border-radius: 12px;
      font-family: inherit;
      font-size: 15px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: var(--shadow-md);
    }
    .profile-gender-btn:hover { border-color: var(--accent); }
    .profile-gender-btn.selected { background: rgba(255, 159, 67, 0.15); border-color: #FF9F43; color: #FF9F43; font-weight: 600; }
    
    .profile-submit { margin-top: auto; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // ============ ERROR TRACKING SYSTEM ============
    const ErrorTracker = {
      errors: JSON.parse(localStorage.getItem('achieve_errors') || '[]'),
      
      log(error, type = 'error', context = {}) {
        const entry = {
          id: Date.now(),
          type, // 'error', 'warning', 'info'
          message: error.message || String(error),
          stack: error.stack || null,
          context: {
            url: window.location.href,
            userAgent: navigator.userAgent,
            timestamp: new Date().toISOString(),
            ...context
          }
        };
        
        this.errors.unshift(entry);
        // Keep only last 100 errors
        if (this.errors.length > 100) {
          this.errors = this.errors.slice(0, 100);
        }
        
        localStorage.setItem('achieve_errors', JSON.stringify(this.errors));
        console.log(`[ErrorTracker] ${type}:`, error);
        
        return entry;
      },
      
      getErrors(filter = 'all') {
        if (filter === 'all') return this.errors;
        return this.errors.filter(e => e.type === filter);
      },
      
      getStats() {
        return {
          total: this.errors.length,
          errors: this.errors.filter(e => e.type === 'error').length,
          warnings: this.errors.filter(e => e.type === 'warning').length,
          info: this.errors.filter(e => e.type === 'info').length,
          lastError: this.errors[0] || null
        };
      },
      
      clear() {
        this.errors = [];
        localStorage.removeItem('achieve_errors');
      },
      
      export() {
        return JSON.stringify(this.errors, null, 2);
      }
    };
    
    // Global error handler
    window.onerror = function(message, source, lineno, colno, error) {
      ErrorTracker.log(error || { message, stack: `at ${source}:${lineno}:${colno}` }, 'error', {
        source, lineno, colno
      });
      return false;
    };
    
    // Unhandled promise rejection handler
    window.onunhandledrejection = function(event) {
      ErrorTracker.log(event.reason || { message: 'Unhandled Promise Rejection' }, 'error', {
        type: 'unhandledrejection'
      });
    };
    
    // Console error interceptor
    const originalConsoleError = console.error;
    console.error = function(...args) {
      const message = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
      if (!message.includes('[ErrorTracker]')) {
        ErrorTracker.log({ message }, 'error', { source: 'console.error' });
      }
      originalConsoleError.apply(console, args);
    };
    
    // Console warn interceptor
    const originalConsoleWarn = console.warn;
    console.warn = function(...args) {
      const message = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
      ErrorTracker.log({ message }, 'warning', { source: 'console.warn' });
      originalConsoleWarn.apply(console, args);
    };

    // Backend API URL - change this when deploying
    const API_URL = 'https://aclio-production.up.railway.app/api';
    
    // Check backend health on load
    let backendAvailable = false;
    fetch(`${API_URL}/health`).then(r => r.json()).then(data => {
      backendAvailable = data.status === 'ok' && data.apiKeyConfigured;
      console.log(backendAvailable ? ' Backend connected' : ' Backend API key not configured');
    }).catch(() => {
      console.log(' Backend not available - please start the server');
    });

    const CATEGORIES = ['Health & Fitness', 'Career', 'Education', 'Finance', 'Creative', 'Personal Growth', 'Relationships', 'Travel', 'Home & Living', 'Technology'];
    
    // Gamification System
    const LEVELS = [
      { level: 1, name: 'Beginner', minPoints: 0, icon: 'star' },
      { level: 2, name: 'Explorer', minPoints: 100, icon: 'zap' },
      { level: 3, name: 'Achiever', minPoints: 300, icon: 'flame' },
      { level: 4, name: 'Champion', minPoints: 600, icon: 'trophy' },
      { level: 5, name: 'Master', minPoints: 1000, icon: 'award' },
      { level: 6, name: 'Expert', minPoints: 1500, icon: 'crown' },
      { level: 7, name: 'Legend', minPoints: 2500, icon: 'gem' },
      { level: 8, name: 'Elite', minPoints: 4000, icon: 'sparkles' },
      { level: 9, name: 'Grandmaster', minPoints: 6000, icon: 'rocket' },
      { level: 10, name: 'Ultimate', minPoints: 10000, icon: 'target' },
    ];
    
    const POINTS = {
      STEP_COMPLETE: 10,
      GOAL_COMPLETE: 50,
      DAILY_BONUS: 25,
      STREAK_BONUS: 5, // per day of streak
      FIRST_GOAL: 30,
    };
    
    const getLevel = (points) => {
      for (let i = LEVELS.length - 1; i >= 0; i--) {
        if (points >= LEVELS[i].minPoints) return LEVELS[i];
      }
      return LEVELS[0];
    };
    
    const getNextLevel = (points) => {
      const currentLevel = getLevel(points);
      const nextIdx = LEVELS.findIndex(l => l.level === currentLevel.level) + 1;
      return nextIdx < LEVELS.length ? LEVELS[nextIdx] : null;
    };
    
    // Dynamic Achievements System
    const ACHIEVEMENTS = [
      { id: 'first_goal', name: 'Goal Setter', desc: 'Created your first goal', icon: 'star', gradient: 'linear-gradient(135deg, #8b5cf6, #6d28d9)', check: (goals) => goals.length >= 1 },
      { id: 'first_step', name: 'First Step', desc: 'Completed your first step', icon: 'rocket', gradient: 'linear-gradient(135deg, #10b981, #059669)', check: (goals) => goals.some(g => g.completedSteps?.length > 0) },
      { id: 'first_complete', name: 'Achiever', desc: 'Completed your first goal', icon: 'trophy', gradient: 'linear-gradient(135deg, #f59e0b, #d97706)', check: (goals, getProgress) => goals.some(g => getProgress(g) === 100) },
      { id: 'streak_3', name: 'On Fire', desc: '3 day streak', icon: 'flame', gradient: 'linear-gradient(135deg, #ef4444, #dc2626)', check: (goals, getProgress, streak) => streak >= 3 },
      { id: 'streak_7', name: 'Unstoppable', desc: '7 day streak', icon: 'zap', gradient: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', check: (goals, getProgress, streak) => streak >= 7 },
      { id: 'five_goals', name: 'Ambitious', desc: 'Created 5 goals', icon: 'target', gradient: 'linear-gradient(135deg, #ec4899, #db2777)', check: (goals) => goals.length >= 5 },
      { id: 'three_complete', name: 'Hat Trick', desc: 'Completed 3 goals', icon: 'award', gradient: 'linear-gradient(135deg, #14b8a6, #0d9488)', check: (goals, getProgress) => goals.filter(g => getProgress(g) === 100).length >= 3 },
      { id: 'ten_steps', name: 'Step Master', desc: 'Completed 10 steps', icon: 'activity', gradient: 'linear-gradient(135deg, #6366f1, #4f46e5)', check: (goals) => goals.reduce((sum, g) => sum + (g.completedSteps?.length || 0), 0) >= 10 },
      { id: 'fifty_steps', name: 'Dedicated', desc: 'Completed 50 steps', icon: 'gem', gradient: 'linear-gradient(135deg, #0ea5e9, #0284c7)', check: (goals) => goals.reduce((sum, g) => sum + (g.completedSteps?.length || 0), 0) >= 50 },
      { id: 'hundred_points', name: 'Century', desc: 'Earned 100 points', icon: 'coins', gradient: 'linear-gradient(135deg, #a855f7, #9333ea)', check: (goals, getProgress, streak, points) => points >= 100 },
      { id: 'five_hundred_points', name: 'Elite', desc: 'Earned 500 points', icon: 'crown', gradient: 'linear-gradient(135deg, #facc15, #eab308)', check: (goals, getProgress, streak, points) => points >= 500 },
      { id: 'level_5', name: 'Master', desc: 'Reached Level 5', icon: 'sparkles', gradient: 'linear-gradient(135deg, #f97316, #ea580c)', check: (goals, getProgress, streak, points) => getLevel(points).level >= 5 },
    ];

    // SVG Icons as components
    const Icons = {
      target: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      fitness: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M6.5 6.5a2.5 2.5 0 0 1 5 0v11a2.5 2.5 0 0 1-5 0z"/><path d="M17.5 6.5a2.5 2.5 0 0 0-5 0v11a2.5 2.5 0 0 0 5 0z"/><path d="M4 12h2M18 12h2"/></svg>,
      book: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>,
      dollar: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      palette: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="13.5" cy="6.5" r="0.5" fill="currentColor"/><circle cx="17.5" cy="10.5" r="0.5" fill="currentColor"/><circle cx="8.5" cy="7.5" r="0.5" fill="currentColor"/><circle cx="6.5" cy="12.5" r="0.5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
      rocket: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"/><path d="M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"/></svg>,
      run: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="17" cy="4" r="2"/><path d="m15 21-3-3 2.5-2.5L18 17v4M7 9l3 3-2.5 2.5L4 13V9"/><path d="m15 9-4.5 4.5"/><path d="M9 21V9l3-3 3 3"/></svg>,
      music: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
      code: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>,
      plane: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/></svg>,
      home: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
      heart: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
      brain: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
      pencil: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>,
      trophy: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
      flame: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>,
      star: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      zap: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      sparkles: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>,
      bell: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>,
      check: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>,
      plus: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      arrowLeft: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
      arrowRight: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
      clock: () => <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      sun: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>,
      moon: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>,
      search: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
      x: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      settings: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
      user: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
      calendar: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      edit: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>,
      trash: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
      chevronRight: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"/></svg>,
      bellRing: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/><path d="M4 2C2.8 3.7 2 5.7 2 8"/><path d="M22 8c0-2.3-.8-4.3-2-6"/></svg>,
      info: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
      refresh: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>,
      mapPin: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>,
      map: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"/><line x1="8" y1="2" x2="8" y2="18"/><line x1="16" y1="6" x2="16" y2="22"/></svg>,
      externalLink: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      expand: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m15 15 6 6m-6-6v4.8m0-4.8h4.8"/><path d="M9 19.8V15m0 0H4.2M9 15l-6 6"/><path d="M15 4.2V9m0 0h4.8M15 9l6-6"/><path d="M9 4.2V9m0 0H4.2M9 9 3 3"/></svg>,
      eye: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      link: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      bookmark: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m19 21-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>,
      barChart: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
      trendingUp: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      award: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>,
      activity: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
      crown: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>,
      gem: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M11 3 8 9l4 13 4-13-3-6"/><path d="M2 9h20"/></svg>,
      coins: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7.71-2.82 2.82"/></svg>,
      bug: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>,
      alertTriangle: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      shield: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      copy: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
      wand: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8 19 13"/><path d="M15 9h0"/><path d="M17.8 6.2 19 5"/><path d="m3 21 9-9"/><path d="M12.2 6.2 11 5"/></svg>,
      fileText: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
      download: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
      share: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>,
      twitter: () => <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>,
      whatsapp: () => <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>,
      image: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
      partyPopper: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M5.8 11.3 2 22l10.7-3.79"/><path d="M4 3h.01"/><path d="M22 8h.01"/><path d="M15 2h.01"/><path d="M22 20h.01"/><path d="m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12v0c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10"/><path d="m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11v0c-.11.7-.72 1.22-1.43 1.22H17"/><path d="m11 2 .33.82c.34.86-.2 1.82-1.11 1.98v0C9.52 4.9 9 5.52 9 6.23V7"/><path d="M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z"/></svg>,
      lock: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
      infinity: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><path d="M12 12c-2-2.67-4-4-6-4a4 4 0 1 0 0 8c2 0 4-1.33 6-4Zm0 0c2 2.67 4 4 6 4a4 4 0 0 0 0-8c-2 0-4 1.33-6 4Z"/></svg>,
      noAds: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="3" x2="21" y2="21"/></svg>,
      send: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
      trash: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
      refreshCw: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
    };
    
    // Premium Subscription Config
    const PREMIUM_CONFIG = {
      FREE_GOAL_LIMIT: 3,
      FREE_DOITFORME_DAILY: 2,
      FREE_EXPAND_DAILY: 3,
      PLANS: {
        weekly: { id: 'aclio_premium_weekly', price: '$2.99', priceNum: 2.99, period: 'week' },
        monthly: { id: 'aclio_premium_monthly', price: '$7.99', priceNum: 7.99, period: 'month' },
        yearly: { id: 'aclio_premium_yearly', price: '$49.99', priceNum: 49.99, period: 'year', isBestValue: true }
      },
      FEATURES: [
        { icon: 'infinity', title: 'Unlimited Goals', desc: 'Create as many goals as you want' },
        { icon: 'wand', title: 'Unlimited "Do it for me"', desc: 'Let AI complete any task for you' },
        { icon: 'share', title: 'Share Achievements', desc: 'Beautiful celebration cards to share' },
        { icon: 'sparkles', title: 'Priority AI', desc: 'Faster, more detailed step generation' },
      ]
    };

    const GOAL_ICON_KEYS = ['target', 'fitness', 'book', 'dollar', 'palette', 'rocket', 'run', 'music', 'code', 'plane', 'home', 'heart', 'brain', 'pencil'];
    const ICON_COLORS = [
      { bg: 'var(--accent-soft)', color: 'var(--accent)' },
      { bg: 'var(--purple-soft)', color: 'var(--purple)' },
      { bg: 'var(--orange-soft)', color: 'var(--orange)' },
      { bg: 'var(--success-soft)', color: 'var(--success)' },
    ];

    const generateSteps = async (goal, profile = {}, location = null, additionalContext = null) => {
      const response = await fetch(`${API_URL}/generate-steps`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ goal, profile, location, additionalContext, categories: CATEGORIES.join(', ') })
      });
      if (!response.ok) { 
        const err = await response.json();
        // Handle inappropriate goal or parse errors with user-friendly message
        if (err.message) {
          throw new Error(err.message);
        }
        throw new Error(err.error || 'Backend server not running. Start it with: cd server && npm start'); 
      }
      return await response.json();
    };

    const saveGoals = (goals) => localStorage.setItem('achieve_goals', JSON.stringify(goals));
    const loadGoals = () => JSON.parse(localStorage.getItem('achieve_goals') || '[]');
    const hasOnboarded = () => localStorage.getItem('achieve_onboarded') === 'true';
    const setOnboarded = () => localStorage.setItem('achieve_onboarded', 'true');
    const saveUserProfile = (profile) => localStorage.setItem('achieve_profile', JSON.stringify(profile));
    const loadUserProfile = () => JSON.parse(localStorage.getItem('achieve_profile') || 'null');
    const saveTheme = (theme) => localStorage.setItem('achieve_theme', theme);
    const loadTheme = () => localStorage.getItem('achieve_theme') || 'light';

    const ONBOARDING_SLIDES = [
      { 
        icon: 'zap',
        iconBg: 'rgba(255, 159, 67, 0.15)',
        iconColor: '#FF9F43',
        image: 'https://em-content.zobj.net/source/apple/391/light-bulb_1f4a1.png',
        title: 'AI-Powered Goal Planning', 
        text: 'Transform your aspirations into personalized, AI-generated action plans tailored to your goals.',
        features: [
          { icon: 'sparkles', text: 'Smart guidance for any goal' },
          { icon: 'zap', text: 'Personalized action plans' },
          { icon: 'target', text: 'Tailored to your timeline' }
        ]
      },
      { 
        icon: 'check',
        iconBg: 'rgba(34, 197, 94, 0.1)',
        iconColor: '#22C55E',
        image: 'https://em-content.zobj.net/source/apple/391/clipboard_1f4cb.png',
        title: 'Step-by-Step Guidance', 
        text: 'Break down your goal into clear, manageable tasks with intelligent coaching that adapts to your progress.',
        tasks: [
          'Research industry trends', 
          'Complete an online course', 
          'Build a portfolio project',
          'Connect with mentors',
          'Apply your new skills'
        ]
      },
      { 
        icon: 'trophy',
        iconBg: 'rgba(255, 179, 71, 0.15)',
        iconColor: '#FFB347',
        image: 'https://em-content.zobj.net/source/apple/391/trophy_1f3c6.png',
        title: 'Track Your Success', 
        text: 'Celebrate milestones, stay motivated, and watch your streaks grow as you achieve your goals.',
        badge: { icon: 'trophy', text: '7-day streak unlocked' }
      },
    ];

    function CircleProgress({ percent, size = 64, stroke = 5 }) {
      const radius = (size - stroke) / 2;
      const circ = radius * 2 * Math.PI;
      const offset = circ - (percent / 100) * circ;
      return (
        <svg width={size} height={size}>
          <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke="var(--border)" strokeWidth={stroke} />
          <circle cx={size/2} cy={size/2} r={radius} fill="none" stroke="var(--accent)" strokeWidth={stroke} strokeDasharray={circ} strokeDashoffset={offset} strokeLinecap="round" />
        </svg>
      );
    }

    function App() {
      const [view, setView] = useState(hasOnboarded() ? 'dashboard' : 'welcome');
      const [onboardStep, setOnboardStep] = useState(0);
      const [goals, setGoals] = useState(loadGoals());
      const [activeGoal, setActiveGoal] = useState(null);
      const [newGoal, setNewGoal] = useState('');
      const [newGoalDueDate, setNewGoalDueDate] = useState('');
      const [goalQuestions, setGoalQuestions] = useState(null); // { questions: [], answers: {} }
      const [questionsLoading, setQuestionsLoading] = useState(false);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');
      const [showCelebration, setShowCelebration] = useState(false);
      const [userProfile, setUserProfile] = useState(loadUserProfile() || { name: '', age: '', gender: '' });
      const [profileStep, setProfileStep] = useState(0);
      const [theme, setTheme] = useState(loadTheme());
      const [searchQuery, setSearchQuery] = useState('');
      const [editModal, setEditModal] = useState(null); // { type: 'goal' | 'step', goalId, stepId?, data }
      const [notificationsEnabled, setNotificationsEnabled] = useState(localStorage.getItem('achieve_notifications') === 'true');
      const [userLocation, setUserLocation] = useState(JSON.parse(localStorage.getItem('achieve_location') || 'null'));
      const [locationLoading, setLocationLoading] = useState(false);
      const [expandModal, setExpandModal] = useState(null); // { goalId, stepId, content, loading }
      const [expandedSteps, setExpandedSteps] = useState({}); // { "goalId-stepId": { content } }
      const [analyticsFilter, setAnalyticsFilter] = useState('goals'); // 'goals' | 'steps'
      
      // Gamification State
      const [userPoints, setUserPoints] = useState(() => parseInt(localStorage.getItem('achieve_points') || '0'));
      const [streakData, setStreakData] = useState(() => JSON.parse(localStorage.getItem('achieve_streak') || '{"current":0,"best":0,"lastActive":null}'));
      const [showLevelUp, setShowLevelUp] = useState(null);
      const [showPointsPopup, setShowPointsPopup] = useState(null);
      const [dailyBonusClaimed, setDailyBonusClaimed] = useState(() => {
        const lastClaim = localStorage.getItem('achieve_daily_bonus');
        return lastClaim === new Date().toDateString();
      });
      const [errorFilter, setErrorFilter] = useState('all');
      const [expandedError, setExpandedError] = useState(null);
      const [errorStats, setErrorStats] = useState(ErrorTracker.getStats());
      const [doItForMeModal, setDoItForMeModal] = useState(null); // { goalId, stepId, step, loading, result }
      const [savedDoItForMe, setSavedDoItForMe] = useState(() => JSON.parse(localStorage.getItem('achieve_doitforme') || '{}'));
      const [shareModal, setShareModal] = useState(null); // { goal, isCompleted }
      const [unlockedAchievements, setUnlockedAchievements] = useState(() => JSON.parse(localStorage.getItem('achieve_badges') || '[]'));
      const shareCardRef = React.useRef(null);
      
      // Premium Subscription State
      const [isPremium, setIsPremium] = useState(() => localStorage.getItem('achieve_premium') === 'true');
      const [showPaywall, setShowPaywall] = useState(false);
      const [selectedPlan, setSelectedPlan] = useState('yearly');
      const [doItForMeUsesToday, setDoItForMeUsesToday] = useState(() => {
        const saved = localStorage.getItem('achieve_doitforme_uses');
        if (saved) {
          const { date, count } = JSON.parse(saved);
          if (date === new Date().toDateString()) return count;
        }
        return 0;
      });
      const [expandUsesToday, setExpandUsesToday] = useState(() => {
        const saved = localStorage.getItem('achieve_expand_uses');
        if (saved) {
          const { date, count } = JSON.parse(saved);
          if (date === new Date().toDateString()) return count;
        }
        return 0;
      });
      
      // Talk to Aclio state
      const [showAclioChat, setShowAclioChat] = useState(false);
      const [aclioMessage, setAclioMessage] = useState('');
      const [aclioLoading, setAclioLoading] = useState(false);
      const [aclioChatHistory, setAclioChatHistory] = useState([]);
      
      // Swipe to delete state
      const [swipingGoalId, setSwipingGoalId] = useState(null);
      const [swipeX, setSwipeX] = useState(0);
      const swipeStartX = React.useRef(0);
      
      // Pull to refresh state
      const [isRefreshing, setIsRefreshing] = useState(false);
      const [pullDistance, setPullDistance] = useState(0);
      const pullStartY = React.useRef(0);
      const dashboardRef = React.useRef(null);

      useEffect(() => { saveGoals(goals); }, [goals]);
      useEffect(() => { if (userProfile.name) saveUserProfile(userProfile); }, [userProfile]);
      useEffect(() => { 
        saveTheme(theme);
        document.documentElement.className = theme === 'dark' ? 'dark' : '';
        // Update meta theme color
        const metaTheme = document.querySelector('meta[name="theme-color"]');
        if (metaTheme) metaTheme.setAttribute('content', theme === 'dark' ? '#1a2b4a' : '#e8f4fc');
      }, [theme]);

      const toggleTheme = () => setTheme(theme === 'dark' ? 'light' : 'dark');
      
      // Notifications
      const requestNotificationPermission = async () => {
        if ('Notification' in window) {
          const permission = await Notification.requestPermission();
          if (permission === 'granted') {
            setNotificationsEnabled(true);
            localStorage.setItem('achieve_notifications', 'true');
            new Notification('Aclio', { body: 'Notifications enabled! We\'ll remind you of your goals.' });
          }
        }
      };
      
      const toggleNotifications = () => {
        if (notificationsEnabled) {
          setNotificationsEnabled(false);
          localStorage.setItem('achieve_notifications', 'false');
        } else {
          requestNotificationPermission();
        }
      };
      
      // Location
      const requestLocation = () => {
        if ('geolocation' in navigator) {
          setLocationLoading(true);
          navigator.geolocation.getCurrentPosition(
            async (position) => {
              const { latitude, longitude } = position.coords;
              // Reverse geocode to get city name
              try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
                const data = await response.json();
                const location = {
                  lat: latitude,
                  lng: longitude,
                  city: data.address?.city || data.address?.town || data.address?.village || 'your area',
                  country: data.address?.country || '',
                  display: data.address?.city || data.address?.town || data.address?.state || 'your location'
                };
                setUserLocation(location);
                localStorage.setItem('achieve_location', JSON.stringify(location));
              } catch (err) {
                const location = { lat: latitude, lng: longitude, city: 'your area', display: 'your location' };
                setUserLocation(location);
                localStorage.setItem('achieve_location', JSON.stringify(location));
              }
              setLocationLoading(false);
            },
            (error) => {
              console.error('Location error:', error);
              setLocationLoading(false);
              alert('Could not get your location. Please enable location services.');
            },
            { enableHighAccuracy: true }
          );
        } else {
          alert('Location is not supported by your browser.');
        }
      };
      
      const clearLocation = () => {
        setUserLocation(null);
        localStorage.removeItem('achieve_location');
      };
      
      // Expand Step with AI
      const expandStep = async (goalId, step, goalName) => {
        const key = `${goalId}-${step.id}`;
        
        // If already expanded, just show it
        if (expandedSteps[key]) {
          setExpandModal({ goalId, stepId: step.id, content: expandedSteps[key], loading: false });
          return;
        }
        
        // Show loading state
        setExpandModal({ goalId, stepId: step.id, step, goalName, content: null, loading: true });
        
        try {
          const response = await fetch(`${API_URL}/expand-step`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ goalName, step })
          });
          if (!response.ok) {
            const err = await response.json();
            throw new Error(err.error || 'Failed to expand step');
          }
          const expandedContent = await response.json();
          setExpandModal({ goalId, stepId: step.id, step, goalName, content: expandedContent, loading: false });
        } catch (err) {
          console.error('Expand error:', err);
          setExpandModal({ goalId, stepId: step.id, step, goalName, content: null, loading: false, error: err.message });
        }
      };
      
      // Save expanded content
      const saveExpandedContent = () => {
        if (expandModal && expandModal.content) {
          const key = `${expandModal.goalId}-${expandModal.stepId}`;
          const newExpanded = { ...expandedSteps, [key]: expandModal.content };
          setExpandedSteps(newExpanded);
          localStorage.setItem('achieve_expanded', JSON.stringify(newExpanded));
          setExpandModal(null);
        }
      };
      
      // Load expanded steps from localStorage
      useEffect(() => {
        const saved = localStorage.getItem('achieve_expanded');
        if (saved) {
          setExpandedSteps(JSON.parse(saved));
        }
      }, []);
      
      // Gamification Functions
      const addPoints = (amount, reason) => {
        const currentLevel = getLevel(userPoints);
        const newPoints = userPoints + amount;
        const newLevel = getLevel(newPoints);
        
        setUserPoints(newPoints);
        localStorage.setItem('achieve_points', newPoints.toString());
        
        // Show points popup
        setShowPointsPopup({ amount, reason });
        setTimeout(() => setShowPointsPopup(null), 1500);
        
        // Check for level up
        if (newLevel.level > currentLevel.level) {
          setTimeout(() => setShowLevelUp(newLevel), 500);
        }
      };
      
      const updateStreak = () => {
        const today = new Date().toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        
        let newStreak = { ...streakData };
        
        if (streakData.lastActive === today) {
          // Already active today
          return;
        } else if (streakData.lastActive === yesterday) {
          // Continue streak
          newStreak.current += 1;
          newStreak.lastActive = today;
          if (newStreak.current > newStreak.best) {
            newStreak.best = newStreak.current;
          }
          // Bonus points for streak
          addPoints(POINTS.STREAK_BONUS * newStreak.current, 'Streak bonus!');
        } else {
          // Streak broken, start new
          newStreak.current = 1;
          newStreak.lastActive = today;
        }
        
        setStreakData(newStreak);
        localStorage.setItem('achieve_streak', JSON.stringify(newStreak));
      };
      
      const claimDailyBonus = () => {
        if (!dailyBonusClaimed) {
          addPoints(POINTS.DAILY_BONUS, 'Daily bonus!');
          setDailyBonusClaimed(true);
          localStorage.setItem('achieve_daily_bonus', new Date().toDateString());
          updateStreak();
        }
      };
      
      // Check and update streak on load
      useEffect(() => {
        const today = new Date().toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        
        if (streakData.lastActive && streakData.lastActive !== today && streakData.lastActive !== yesterday) {
          // Streak broken
          const newStreak = { ...streakData, current: 0 };
          setStreakData(newStreak);
          localStorage.setItem('achieve_streak', JSON.stringify(newStreak));
        }
      }, []);
      
      // Do It For Me Feature
      const canDoItForMe = (stepTitle, stepDesc) => {
        const text = (stepTitle + ' ' + stepDesc).toLowerCase();
        const actionableKeywords = [
          'create', 'make', 'write', 'draft', 'design', 'plan', 'schedule',
          'list', 'outline', 'template', 'budget', 'meal plan', 'workout',
          'routine', 'checklist', 'timeline', 'roadmap', 'strategy',
          'script', 'email', 'letter', 'proposal', 'resume', 'cv',
          'study guide', 'flashcards', 'notes', 'summary', 'syllabus',
          'itinerary', 'packing list', 'shopping list', 'grocery',
          'recipe', 'menu', 'diet plan', 'exercise', 'training',
          'business plan', 'marketing', 'content calendar', 'social media'
        ];
        return actionableKeywords.some(keyword => text.includes(keyword));
      };
      
      const doItForMe = async (goalId, step, goalName) => {
        const key = `${goalId}-${step.id}`;
        
        // If already done, show saved result
        if (savedDoItForMe[key]) {
          setDoItForMeModal({ goalId, stepId: step.id, step, goalName, loading: false, result: savedDoItForMe[key] });
          return;
        }
        
        setDoItForMeModal({ goalId, stepId: step.id, step, goalName, loading: true, result: null });
        
        try {
          const response = await fetch(`${API_URL}/do-it-for-me`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ goalName, step, profile: userProfile })
          });
          
          if (!response.ok) {
            const err = await response.json();
            throw new Error(err.error || 'Failed to complete task');
          }
          
          const data = await response.json();
          setDoItForMeModal({ goalId, stepId: step.id, step, goalName, loading: false, result: data.result });
        } catch (err) {
          ErrorTracker.log(err, 'error', { action: 'doItForMe', step: step.title });
          setDoItForMeModal({ goalId, stepId: step.id, step, goalName, loading: false, result: null, error: err.message });
        }
      };
      
      const saveDoItForMeResult = () => {
        if (doItForMeModal && doItForMeModal.result) {
          const key = `${doItForMeModal.goalId}-${doItForMeModal.stepId}`;
          const newSaved = { ...savedDoItForMe, [key]: doItForMeModal.result };
          setSavedDoItForMe(newSaved);
          localStorage.setItem('achieve_doitforme', JSON.stringify(newSaved));
          
          // Award points
          addPoints(15, '+15 AI assist!');
        }
      };
      
      const copyDoItForMeResult = () => {
        if (doItForMeModal?.result) {
          navigator.clipboard.writeText(doItForMeModal.result);
          alert('Copied to clipboard!');
        }
      };
      
      const downloadDoItForMeResult = () => {
        if (doItForMeModal?.result) {
          const blob = new Blob([doItForMeModal.result], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${doItForMeModal.step.title.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.txt`;
          a.click();
        }
      };
      
      // Talk to Aclio - chat about the goal (Premium only)
      const sendAclioMessage = async (goal) => {
        if (!aclioMessage.trim()) return;
        
        const userMessage = aclioMessage.trim();
        setAclioMessage('');
        setAclioChatHistory(prev => [...prev, { role: 'user', content: userMessage }]);
        setAclioLoading(true);
        
        try {
          const response = await fetch(`${API_URL}/talk-to-aclio`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
              goalName: goal.name,
              goalCategory: goal.category,
              steps: goal.steps,
              completedSteps: goal.completedSteps,
              message: userMessage,
              chatHistory: aclioChatHistory.slice(-6), // Last 6 messages for context
              profile: userProfile
            })
          });
          
          if (!response.ok) {
            const err = await response.json();
            throw new Error(err.message || err.error || 'Failed to get response');
          }
          
          const data = await response.json();
          setAclioChatHistory(prev => [...prev, { role: 'assistant', content: data.response }]);
        } catch (err) {
          ErrorTracker.log(err, 'error', { action: 'talkToAclio' });
          setAclioChatHistory(prev => [...prev, { role: 'assistant', content: "Sorry, I couldn't process that. Please try again!" }]);
        } finally {
          setAclioLoading(false);
        }
      };
      
      const openAclioChat = (goal) => {
        setAclioChatHistory([
          { role: 'assistant', content: `Hi! I'm here to help you with "${goal.name}". You can ask me for more guidance, request additional steps, or tell me more about your situation so I can tailor the plan better. What would you like to know?` }
        ]);
        setShowAclioChat(true);
      };
      
      // Swipe to delete handlers
      const handleSwipeStart = (e, goalId) => {
        const touch = e.touches ? e.touches[0] : e;
        swipeStartX.current = touch.clientX;
        setSwipingGoalId(goalId);
      };
      
      const handleSwipeMove = (e, goalId) => {
        if (swipingGoalId !== goalId) return;
        const touch = e.touches ? e.touches[0] : e;
        const diff = swipeStartX.current - touch.clientX;
        // Only allow left swipe, max 100px
        const newX = Math.max(0, Math.min(100, diff));
        setSwipeX(newX);
      };
      
      const handleSwipeEnd = (goalId) => {
        if (swipeX > 60) {
          // Show delete confirmation
          if (confirm('Delete this goal?')) {
            deleteGoal(goalId);
          }
        }
        setSwipeX(0);
        setSwipingGoalId(null);
      };
      
      // Pull to refresh handlers
      const handlePullStart = (e) => {
        if (dashboardRef.current?.scrollTop === 0) {
          const touch = e.touches ? e.touches[0] : e;
          pullStartY.current = touch.clientY;
        }
      };
      
      const handlePullMove = (e) => {
        if (pullStartY.current === 0 || isRefreshing) return;
        if (dashboardRef.current?.scrollTop > 0) {
          pullStartY.current = 0;
          setPullDistance(0);
          return;
        }
        const touch = e.touches ? e.touches[0] : e;
        const diff = touch.clientY - pullStartY.current;
        if (diff > 0) {
          setPullDistance(Math.min(diff * 0.5, 80));
          e.preventDefault();
        }
      };
      
      const handlePullEnd = async () => {
        if (pullDistance > 60 && !isRefreshing) {
          setIsRefreshing(true);
          // Simulate refresh - reload data from localStorage
          await new Promise(resolve => setTimeout(resolve, 800));
          setGoals(loadGoals());
          checkAchievements();
          setIsRefreshing(false);
        }
        pullStartY.current = 0;
        setPullDistance(0);
      };
      
      // Check and unlock achievements
      const checkAchievements = () => {
        const newUnlocked = [];
        ACHIEVEMENTS.forEach(ach => {
          if (!unlockedAchievements.includes(ach.id)) {
            if (ach.check(goals, getProgress, streakData.current, userPoints)) {
              newUnlocked.push(ach.id);
            }
          }
        });
        if (newUnlocked.length > 0) {
          const allUnlocked = [...unlockedAchievements, ...newUnlocked];
          setUnlockedAchievements(allUnlocked);
          localStorage.setItem('achieve_badges', JSON.stringify(allUnlocked));
          // Show toast for new achievements
          newUnlocked.forEach((id, i) => {
            const ach = ACHIEVEMENTS.find(a => a.id === id);
            setTimeout(() => {
              setShowPointsPopup({ amount: '', reason: ` ${ach.name} unlocked!` });
            }, i * 1500);
          });
        }
      };
      
      // Check achievements whenever relevant data changes
      useEffect(() => {
        checkAchievements();
      }, [goals, userPoints, streakData]);
      
      // Share goal functions
      const shareGoal = (goal) => {
        const isCompleted = getProgress(goal) === 100;
        setShareModal({ goal, isCompleted });
      };
      
      const downloadShareCard = async () => {
        if (!shareCardRef.current) return;
        
        try {
          // Use html2canvas dynamically loaded
          if (!window.html2canvas) {
            const script = document.createElement('script');
            script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
            document.head.appendChild(script);
            await new Promise(resolve => script.onload = resolve);
          }
          
          const canvas = await window.html2canvas(shareCardRef.current, {
            backgroundColor: null,
            scale: 2,
            useCORS: true
          });
          
          const link = document.createElement('a');
          link.download = `achieve-ai-${shareModal.goal.name.replace(/[^a-z0-9]/gi, '-').toLowerCase()}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
        } catch (err) {
          console.error('Download failed:', err);
          alert('Could not download image. Try taking a screenshot instead!');
        }
      };
      
      const shareToTwitter = () => {
        const text = shareModal.isCompleted 
          ? ` I just completed my goal: "${shareModal.goal.name}" with Aclio! ${shareModal.goal.steps.length} steps crushed! `
          : ` Working on my goal: "${shareModal.goal.name}" with Aclio! ${getProgress(shareModal.goal)}% complete!`;
        const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
        window.open(url, '_blank');
      };
      
      const shareToWhatsApp = () => {
        const text = shareModal.isCompleted 
          ? ` I just completed my goal: "${shareModal.goal.name}" with Aclio! ${shareModal.goal.steps.length} steps crushed! `
          : ` Working on my goal: "${shareModal.goal.name}" with Aclio! ${getProgress(shareModal.goal)}% complete!`;
        const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
        window.open(url, '_blank');
      };
      
      const copyShareLink = () => {
        const text = shareModal.isCompleted 
          ? ` I just completed my goal: "${shareModal.goal.name}" with Aclio! ${shareModal.goal.steps.length} steps crushed!  #Aclio`
          : ` Working on my goal: "${shareModal.goal.name}" with Aclio! ${getProgress(shareModal.goal)}% complete! #Aclio`;
        navigator.clipboard.writeText(text);
        alert('Copied to clipboard!');
      };
      
      // Premium Subscription Functions
      const canCreateGoal = () => {
        if (isPremium) return true;
        return goals.length < PREMIUM_CONFIG.FREE_GOAL_LIMIT;
      };
      
      const canUseDoItForMe = () => {
        if (isPremium) return true;
        return doItForMeUsesToday < PREMIUM_CONFIG.FREE_DOITFORME_DAILY;
      };
      
      const canUseExpand = () => {
        if (isPremium) return true;
        return expandUsesToday < PREMIUM_CONFIG.FREE_EXPAND_DAILY;
      };
      
      const canShareGoal = () => {
        return isPremium;
      };
      
      const trackDoItForMeUse = () => {
        const newCount = doItForMeUsesToday + 1;
        setDoItForMeUsesToday(newCount);
        localStorage.setItem('achieve_doitforme_uses', JSON.stringify({
          date: new Date().toDateString(),
          count: newCount
        }));
      };
      
      const trackExpandUse = () => {
        const newCount = expandUsesToday + 1;
        setExpandUsesToday(newCount);
        localStorage.setItem('achieve_expand_uses', JSON.stringify({
          date: new Date().toDateString(),
          count: newCount
        }));
      };
      
      const handlePremiumFeature = (feature, callback) => {
        let hasAccess = false;
        switch(feature) {
          case 'goal': hasAccess = canCreateGoal(); break;
          case 'doitforme': hasAccess = canUseDoItForMe(); break;
          case 'expand': hasAccess = canUseExpand(); break;
          case 'share': hasAccess = canShareGoal(); break;
          default: hasAccess = isPremium;
        }
        
        if (hasAccess) {
          if (callback) callback();
        } else {
          setShowPaywall(true);
        }
      };
      
      const handlePurchase = async () => {
        const plan = PREMIUM_CONFIG.PLANS[selectedPlan];
        
        // Check if running in Capacitor (native iOS)
        const Purchases = window.Capacitor?.Plugins?.Purchases;
        if (Purchases) {
          try {
            // Get offerings first
            const offeringsResult = await Purchases.getOfferings();
            console.log('Offerings result:', JSON.stringify(offeringsResult, null, 2));
            
            // The offerings might be nested differently
            const offerings = offeringsResult?.offerings || offeringsResult;
            console.log('Parsed offerings:', JSON.stringify(offerings, null, 2));
            
            if (!offerings?.current) {
              throw new Error('No offerings available - check RevenueCat dashboard');
            }
            
            // Get the package directly from offerings.current
            let pkg = null;
            if (selectedPlan === 'yearly' && offerings.current.annual) {
              pkg = offerings.current.annual;
            } else if (selectedPlan === 'monthly' && offerings.current.monthly) {
              pkg = offerings.current.monthly;
            } else if (selectedPlan === 'weekly' && offerings.current.weekly) {
              pkg = offerings.current.weekly;
            }
            
            // Fallback: search in availablePackages
            if (!pkg && offerings.current.availablePackages) {
              pkg = offerings.current.availablePackages.find(p => 
                p.product?.identifier === plan.id ||
                p.identifier?.toLowerCase().includes(selectedPlan)
              );
            }
            
            if (!pkg) {
              console.error('Available packages:', offerings.current.availablePackages);
              throw new Error('Package not found for: ' + selectedPlan);
            }
            
            console.log('Purchasing package:', JSON.stringify(pkg, null, 2));
            
            // Purchase the package - pass the package object directly
            const result = await Purchases.purchasePackage({ 
              aPackage: pkg 
            });
            
            console.log('Purchase result:', JSON.stringify(result, null, 2));
            
            // Check if premium entitlement is now active
            if (result?.customerInfo?.entitlements?.active?.['Aclio Premium']) {
              setIsPremium(true);
              localStorage.setItem('achieve_premium', 'true');
              setShowPaywall(false);
              alert(' Welcome to Premium!');
            }
          } catch (error) {
            console.error('Full purchase error:', JSON.stringify(error, null, 2));
            if (error.code === 'PURCHASE_CANCELLED' || 
                error.code === 1 ||
                error.message?.includes('cancelled') ||
                error.message?.includes('canceled')) {
              console.log('User cancelled purchase');
            } else {
              console.error('Purchase error:', error);
              alert('Purchase failed: ' + (error.message || error.code || 'Unknown error'));
            }
          }
        } else {
          // Web fallback - for testing only
          console.log('Purchase initiated for:', plan.id);
          const confirmed = confirm(`This would purchase ${selectedPlan} for ${plan.price}/${plan.period}.\n\nFor testing, click OK to simulate a successful purchase.`);
          if (confirmed) {
            setIsPremium(true);
            localStorage.setItem('achieve_premium', 'true');
            setShowPaywall(false);
          }
        }
      };
      
      const restorePurchases = async () => {
        const Purchases = window.Capacitor?.Plugins?.Purchases;
        if (Purchases) {
          try {
            const { customerInfo } = await Purchases.restorePurchases();
            
            if (customerInfo.entitlements.active['Aclio Premium']) {
              setIsPremium(true);
              localStorage.setItem('achieve_premium', 'true');
              setShowPaywall(false);
              alert('Premium restored successfully!');
            } else {
              alert('No previous purchases found.');
            }
          } catch (error) {
            console.error('Restore error:', error);
            alert('Could not restore purchases. Please try again.');
          }
        } else {
          // Web fallback
          const restored = localStorage.getItem('achieve_premium') === 'true';
          if (restored) {
            setIsPremium(true);
            alert('Premium restored!');
          } else {
            alert('No previous purchases found.');
          }
        }
      };
      
      // Initialize RevenueCat on app load (for native)
      const initRevenueCat = async () => {
        const Purchases = window.Capacitor?.Plugins?.Purchases;
        if (Purchases) {
          try {
            await Purchases.configure({ 
              apiKey: 'appl_bDbfydrvxEqoWAvaZPwQeWoWCtY' // RevenueCat Production API key
            });
            
            // Check current subscription status
            const { customerInfo } = await Purchases.getCustomerInfo();
            if (customerInfo.entitlements.active['Aclio Premium']) {
              setIsPremium(true);
              localStorage.setItem('achieve_premium', 'true');
            }
            
            console.log('RevenueCat initialized successfully');
          } catch (error) {
            console.error('RevenueCat init error:', error);
          }
        }
      };
      
      // eslint-disable-next-line react-hooks/exhaustive-deps
      useEffect(() => { initRevenueCat(); }, []);
      
      // Generate contextual questions for a goal
      const generateQuestions = async (goal) => {
        if (!goal.trim()) return;
        setQuestionsLoading(true);
        
        try {
          const response = await fetch(`${API_URL}/generate-questions`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ goal })
          });
          
          if (!response.ok) throw new Error('Failed to generate questions');
          
          const data = await response.json();
          setGoalQuestions({ questions: data.questions, answers: {} });
        } catch (err) {
          console.error('Questions error:', err);
          // Fallback to generic questions if backend fails
          setGoalQuestions({
            questions: [
              { id: 1, question: "What's your current experience level?", placeholder: "e.g., Beginner, Intermediate" },
              { id: 2, question: "What's your main motivation?", placeholder: "e.g., Career, Personal growth, Fun" },
              { id: 3, question: "Any specific focus or preferences?", placeholder: "e.g., Online learning, Hands-on practice" }
            ],
            answers: {}
          });
        }
        setQuestionsLoading(false);
      };
      
      const updateQuestionAnswer = (questionId, answer) => {
        setGoalQuestions(prev => ({
          ...prev,
          answers: { ...prev.answers, [questionId]: answer }
        }));
      };
      
      const resetGoalForm = () => {
        setNewGoal('');
        setNewGoalDueDate('');
        setGoalQuestions(null);
      };
      
      // Send reminder notification
      useEffect(() => {
        if (notificationsEnabled && goals.length > 0) {
          const checkReminders = () => {
            const now = new Date();
            goals.forEach(goal => {
              if (goal.dueDate) {
                const due = new Date(goal.dueDate);
                const daysLeft = Math.ceil((due - now) / (1000 * 60 * 60 * 24));
                if (daysLeft === 1 || daysLeft === 3) {
                  // Show notification for goals due soon
                }
              }
            });
          };
          const interval = setInterval(checkReminders, 60000 * 60); // Check every hour
          return () => clearInterval(interval);
        }
      }, [notificationsEnabled, goals]);
      
      // Edit goal
      const updateGoal = (goalId, updates) => {
        setGoals(goals.map(g => g.id === goalId ? { ...g, ...updates } : g));
        setEditModal(null);
      };
      
      // Edit step
      const updateStep = (goalId, stepId, updates) => {
        setGoals(goals.map(g => {
          if (g.id !== goalId) return g;
          return {
            ...g,
            steps: g.steps.map(s => s.id === stepId ? { ...s, ...updates } : s)
          };
        }));
        setEditModal(null);
      };
      
      // Filter goals by search
      const filteredGoals = goals.filter(g => 
        g.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
        g.category?.toLowerCase().includes(searchQuery.toLowerCase())
      );
      
      // Get due date status
      const getDueDateStatus = (dueDate) => {
        if (!dueDate) return null;
        const now = new Date();
        const due = new Date(dueDate);
        const daysLeft = Math.ceil((due - now) / (1000 * 60 * 60 * 24));
        if (daysLeft < 0) return { status: 'overdue', text: `${Math.abs(daysLeft)} days overdue` };
        if (daysLeft === 0) return { status: 'soon', text: 'Due today' };
        if (daysLeft <= 3) return { status: 'soon', text: `${daysLeft} days left` };
        return { status: 'normal', text: `${daysLeft} days left` };
      };

      const finishOnboarding = () => { 
        setOnboarded(); 
        saveUserProfile(userProfile);
        setView('dashboard'); 
      };

      const createGoal = async () => {
        if (!newGoal.trim() || loading) return;
        setLoading(true); setError('');
        try {
          // Build additional context from questions
          let additionalContext = null;
          if (goalQuestions?.questions && Object.keys(goalQuestions.answers).length > 0) {
            additionalContext = goalQuestions.questions
              .map(q => `${q.question} ${goalQuestions.answers[q.id] || 'Not specified'}`)
              .join('\n');
          }
          
          const result = await generateSteps(newGoal, userProfile, userLocation, additionalContext);
          const steps = result.steps || result; // Handle both new and old format
          const category = result.category || 'Personal Growth';
          
          // Match icon to category
          const categoryIcons = {
            'Health & Fitness': 'fitness',
            'Career': 'rocket',
            'Education': 'book',
            'Finance': 'dollar',
            'Creative': 'palette',
            'Personal Growth': 'brain',
            'Relationships': 'heart',
            'Travel': 'plane',
            'Home & Living': 'home',
            'Technology': 'code'
          };
          
          const categoryColors = {
            'Health & Fitness': { bg: 'var(--success-soft)', color: 'var(--success)' },
            'Career': { bg: 'var(--accent-soft)', color: 'var(--accent)' },
            'Education': { bg: 'var(--purple-soft)', color: 'var(--purple)' },
            'Finance': { bg: 'var(--gold-soft)', color: '#b45309' },
            'Creative': { bg: 'var(--pink-soft, rgba(236,72,153,0.1))', color: 'var(--pink)' },
            'Personal Growth': { bg: 'var(--accent-soft)', color: 'var(--accent)' },
            'Relationships': { bg: 'rgba(236,72,153,0.1)', color: 'var(--pink)' },
            'Travel': { bg: 'var(--accent-soft)', color: 'var(--accent)' },
            'Home & Living': { bg: 'var(--orange-soft)', color: 'var(--orange)' },
            'Technology': { bg: 'var(--purple-soft)', color: 'var(--purple)' }
          };
          
          const goal = {
            id: Date.now(),
            name: newGoal,
            category: category,
            iconKey: categoryIcons[category] || 'target',
            iconColor: categoryColors[category] || ICON_COLORS[0],
            steps,
            completedSteps: [],
            dueDate: newGoalDueDate || null,
            createdAt: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
          };
          // Award points for first goal
          if (goals.length === 0) {
            addPoints(POINTS.FIRST_GOAL, '+30 First goal!');
          }
          
          setGoals([goal, ...goals]);
          resetGoalForm();
          setView('dashboard');
        } catch (err) { 
          setError(err.message);
          ErrorTracker.log(err, 'error', { action: 'createGoal', goal: newGoal });
        }
        finally { setLoading(false); }
      };

      const toggleStep = (goalId, stepId) => {
        setGoals(goals.map(g => {
          if (g.id !== goalId) return g;
          const done = g.completedSteps.includes(stepId);
          const completed = done ? g.completedSteps.filter(id => id !== stepId) : [...g.completedSteps, stepId];
          
          // Award points for completing step
          if (!done) {
            addPoints(POINTS.STEP_COMPLETE, '+10 Step done!');
            updateStreak();
            
            // Bonus for completing goal
            if (completed.length === g.steps.length) {
              setTimeout(() => {
                addPoints(POINTS.GOAL_COMPLETE, '+50 Goal complete!');
                setShowCelebration(true);
              }, 300);
            }
          }
          
          return { ...g, completedSteps: completed };
        }));
      };

      const deleteGoal = (id) => { if(confirm('Delete this goal?')) { setGoals(goals.filter(g => g.id !== id)); setView('dashboard'); } };

      const getProgress = (g) => g.steps.length ? Math.round((g.completedSteps.length / g.steps.length) * 100) : 0;
      const getNextStep = (g) => g.steps.find(s => !g.completedSteps.includes(s.id));
      
      const todayTasks = goals.flatMap(g => {
        const next = getNextStep(g);
        return next ? [{ ...next, goalName: g.name, goalId: g.id, done: false }] : [];
      }).slice(0, 3);

      const totalDone = goals.reduce((sum, g) => sum + g.completedSteps.length, 0);
      const streak = Math.min(7, totalDone); // Simple streak calc

      const getGreeting = () => {
        const h = new Date().getHours();
        if (h < 12) return 'Good Morning';
        if (h < 18) return 'Good Afternoon';
        return 'Good Evening';
      };

      const suggestions = ["Learn a new language", "Run a marathon", "Start a side business", "Read 20 books this year"];

      // WELCOME SCREEN - Aclio Style
      if (view === 'welcome') {
        return (
          <div className="app app-no-scroll">
            <div className="welcome-screen fade-in">
              <div className="welcome-content">
                {/* Flame Bunny Mascot */}
                <div className="welcome-mascot">
                  <img src="/mascot.png" alt="Aclio Mascot" />
                </div>
                <h1 className="welcome-title">Aclio</h1>
                <p className="welcome-tagline">Ignite your goals.</p>
              </div>
              
              <div className="welcome-bottom">
                <button className="welcome-btn" onClick={() => setView('onboarding')}>
                  Get Started
                </button>
                <p className="welcome-signin">Already have an account? <button onClick={() => { setOnboarded(); setView('dashboard'); }}>Sign in</button></p>
              </div>
            </div>
          </div>
        );
      }

      // ONBOARDING - INTRO SCREENS
      if (view === 'onboarding') {
        const slide = ONBOARDING_SLIDES[onboardStep];
        const SlideIcon = Icons[slide.icon];
        return (
          <div className="app app-no-scroll">
            <div className="onboarding fade-in" key={onboardStep}>
              <button className="onboarding-skip-top" onClick={() => setView('profile-setup')}>Skip</button>
              
              <div className="onboarding-content">
                {/* Illustration */}
                <div className="onboarding-illustration">
                  <div className="onboarding-blob">
                    <div className="onboarding-image-container">
                      <img src={slide.image} alt="" className="onboarding-image" />
                    </div>
                    <div className="onboarding-icon-badge" style={{background: slide.iconBg, color: slide.iconColor}}>
                      <SlideIcon />
                    </div>
                  </div>
                </div>
                
                {/* Title & Subtitle */}
                <h1 className="onboarding-title">{slide.title}</h1>
                <p className="onboarding-text">{slide.text}</p>
                
                {/* Screen 1: Feature List */}
                {slide.features && (
                  <div className="onboarding-features">
                    {slide.features.map((feature, i) => {
                      const FeatureIcon = Icons[feature.icon];
                      return (
                        <div key={i} className="onboarding-feature-item">
                          <span className="onboarding-feature-icon"><FeatureIcon /></span>
                          <span>{feature.text}</span>
                        </div>
                      );
                    })}
                  </div>
                )}
                
                {/* Screen 2: Task Cards */}
                {slide.tasks && (
                  <div className="onboarding-task-list">
                    {slide.tasks.slice(0, 4).map((task, i) => (
                      <div key={task} className={`onboarding-task-card ${i < 2 ? 'completed' : ''}`}>
                        <div className="onboarding-task-icon">
                          {i < 2 ? <Icons.check /> : <div className="onboarding-task-bullet" />}
                        </div>
                        <span className={i < 2 ? 'task-done' : ''}>{task}</span>
                      </div>
                    ))}
                  </div>
                )}
                
                {/* Screen 3: Achievement Badge */}
                {slide.badge && (
                  <div className="onboarding-badge">
                    <span className="onboarding-badge-icon"><Icons.trophy /></span>
                    <span>{slide.badge.text}</span>
                  </div>
                )}
              </div>
              
              {/* Bottom Section */}
              <div className="onboarding-footer">
                <div className="onboarding-dots">
                  {ONBOARDING_SLIDES.map((_, i) => (
                    <div key={i} className={`onboarding-dot ${i === onboardStep ? 'active' : ''}`} />
                  ))}
                </div>
                <button className="onboarding-cta" onClick={() => onboardStep < 2 ? setOnboardStep(onboardStep + 1) : setView('profile-setup')}>
                  {onboardStep < 2 ? 'Next' : 'Get Started'}
                </button>
              </div>
            </div>
          </div>
        );
      }

      // PROFILE SETUP - All on one page
      if (view === 'profile-setup') {
        const canContinue = userProfile.name.trim();

        return (
          <div className="app app-no-scroll">
            <div className="profile-setup fade-in">
              <button className="onboarding-skip-top" onClick={finishOnboarding}>Skip</button>
              
              <div className="profile-header">
                <h1 className="profile-title">Tell us about yourself</h1>
                <p className="profile-subtitle">This helps us personalize your experience</p>
              </div>

              <div className="profile-form">
                <div className="profile-field">
                  <label className="profile-label">Your Name *</label>
                  <input
                    className="profile-input"
                    type="text"
                    placeholder="e.g., Theyab"
                    value={userProfile.name}
                    onChange={(e) => setUserProfile({...userProfile, name: e.target.value})}
                    autoFocus
                  />
                </div>

                <div className="profile-field">
                  <label className="profile-label">Your Age</label>
                  <input
                    className="profile-input"
                    type="number"
                    placeholder="e.g., 22"
                    value={userProfile.age}
                    onChange={(e) => setUserProfile({...userProfile, age: e.target.value})}
                  />
                </div>

                <div className="profile-field">
                  <label className="profile-label">Gender</label>
                  <div className="profile-gender-options">
                    {['Male', 'Female', 'Other'].map(option => (
                      <button
                        key={option}
                        className={`profile-gender-btn ${userProfile.gender === option ? 'selected' : ''}`}
                        onClick={() => setUserProfile({...userProfile, gender: option})}
                      >
                        {option}
                      </button>
                    ))}
                  </div>
                </div>
              </div>

              <button 
                className="onboarding-btn profile-submit" 
                onClick={finishOnboarding}
                disabled={!canContinue}
              >
                {canContinue ? `Continue as ${userProfile.name}` : 'Enter your name to continue'}
              </button>
            </div>
          </div>
        );
      }

      // DASHBOARD
      if (view === 'dashboard') {
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <span className="header-title">Dashboard</span>
              </div>
              <div className="header-right">
                <button className="header-icon" onClick={() => setView('analytics')}><Icons.barChart /></button>
                <button className="header-icon" onClick={toggleTheme}>
                  {theme === 'dark' ? <Icons.sun /> : <Icons.moon />}
                </button>
                <button className="header-icon" onClick={() => setView('settings')}><Icons.settings /></button>
              </div>
            </header>

            <div 
              className="dashboard fade-in" 
              ref={dashboardRef}
              onTouchStart={handlePullStart}
              onTouchMove={handlePullMove}
              onTouchEnd={handlePullEnd}
            >
              {/* Pull to Refresh Indicator */}
              <div className={`pull-refresh-indicator ${pullDistance > 20 || isRefreshing ? 'visible' : ''} ${isRefreshing ? 'refreshing' : ''}`}>
                <Icons.refreshCw className="pull-refresh-icon" />
                <span>{isRefreshing ? 'Refreshing...' : pullDistance > 60 ? 'Release to refresh' : 'Pull to refresh'}</span>
              </div>
              
              <div className="greeting-section">
                <div>
                  <p className="greeting-text">{getGreeting()}</p>
                  <h1 className="greeting-name">{userProfile?.name || 'Achiever'}</h1>
                  {userLocation && (
                    <div className="location-badge" style={{marginTop: '8px'}}>
                      <Icons.mapPin /> {userLocation.display}
                    </div>
                  )}
                </div>
                {isPremium && (
                  <div className="premium-badge">
                    <Icons.crown /> Premium
                  </div>
                )}
              </div>
              
              {/* Premium Banner - Only show for free users */}
              {!isPremium && (
                <div className="premium-banner" onClick={() => setShowPaywall(true)}>
                  <div className="premium-banner-content">
                    <div className="premium-banner-header">
                      <div className="premium-banner-icon"><Icons.crown /></div>
                      <span className="premium-banner-title">Go Premium</span>
                    </div>
                    <p className="premium-banner-desc">
                      Unlock unlimited goals, AI assistance, and achievement sharing!
                    </p>
                    <div className="premium-banner-features">
                      <span className="premium-banner-feature"><Icons.infinity /> Unlimited</span>
                      <span className="premium-banner-feature"><Icons.wand /> AI Help</span>
                      <span className="premium-banner-feature"><Icons.share /> Share</span>
                    </div>
                    <button className="premium-banner-btn" onClick={(e) => { e.stopPropagation(); setShowPaywall(true); }}>
                      Try Free for 3 Days
                    </button>
                  </div>
                </div>
              )}
              
              {/* Search Bar */}
              <div className="search-bar">
                <Icons.search />
                <input 
                  className="search-input" 
                  placeholder="Search goals..." 
                  value={searchQuery}
                  onChange={(e) => setSearchQuery(e.target.value)}
                />
                {searchQuery && (
                  <button className="search-clear" onClick={() => setSearchQuery('')}>
                    <Icons.x />
                  </button>
                )}
              </div>

              {todayTasks.length > 0 && (
                <div className="section">
                  <div className="focus-card">
                    <div className="focus-header">
                      <span className="focus-icon" style={{color: 'var(--accent)'}}><Icons.sparkles /></span>
                      <span className="focus-title">Today's Focus</span>
                    </div>
                    {todayTasks.map(task => {
                      const goal = goals.find(g => g.id === task.goalId);
                      const isDone = goal?.completedSteps.includes(task.id);
                      return (
                        <div key={`${task.goalId}-${task.id}`} className="focus-item" onClick={() => toggleStep(task.goalId, task.id)}>
                          <div className={`focus-check ${isDone ? 'checked' : ''}`}>{isDone && <Icons.check />}</div>
                          <div className="focus-content">
                            <p className={`focus-task ${isDone ? 'done' : ''}`}>{task.title}</p>
                            <p className="focus-goal">{task.goalName}</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}

              <div className="section">
                <div className="section-header">
                  <h2 className="section-title">Active Goals</h2>
                </div>

                {filteredGoals.length > 0 ? filteredGoals.map((goal, i) => {
                  const progress = getProgress(goal);
                  const next = getNextStep(goal);
                  const iconBg = goal.iconColor?.bg || 'var(--accent-soft)';
                  const iconColor = goal.iconColor?.color || 'var(--accent)';
                  const IconComponent = Icons[goal.iconKey] || Icons.target;
                  const dueDateInfo = getDueDateStatus(goal.dueDate);
                  const isSwiping = swipingGoalId === goal.id;
                  return (
                    <div key={goal.id} className="goal-card-wrapper slide-up" style={{animationDelay: `${i * 0.1}s`}}>
                      <div className="goal-card-delete" onClick={() => { if(confirm('Delete this goal?')) deleteGoal(goal.id); }}>
                        <Icons.trash />
                      </div>
                      <div 
                        className={`goal-card ${isSwiping ? 'swiping' : ''}`}
                        style={{transform: isSwiping ? `translateX(-${swipeX}px)` : 'translateX(0)'}}
                        onClick={() => { if (!isSwiping || swipeX < 10) { setActiveGoal(goal); setView('detail'); } }}
                        onTouchStart={(e) => handleSwipeStart(e, goal.id)}
                        onTouchMove={(e) => handleSwipeMove(e, goal.id)}
                        onTouchEnd={() => handleSwipeEnd(goal.id)}
                      >
                        <div className="goal-header">
                          <div className="goal-icon-wrap" style={{background: iconBg, color: iconColor}}>
                            <IconComponent />
                          </div>
                          <div className="goal-info">
                            <h3 className="goal-name">{goal.name}</h3>
                            <p className="goal-category">{goal.category || 'Personal Goal'}</p>
                            {dueDateInfo && (
                              <div className={`due-date-badge ${dueDateInfo.status}`}>
                                <Icons.calendar /> {dueDateInfo.text}
                              </div>
                            )}
                          </div>
                        </div>
                        <div className="goal-progress-row">
                          <span className="goal-progress-label">Progress</span>
                          <span className="goal-progress-value">{progress}%</span>
                        </div>
                        <div className="goal-progress-bar">
                          <div className="goal-progress-fill" style={{width: `${progress}%`}} />
                        </div>
                        {next && (
                          <div className="goal-next">
                            <span className="goal-next-arrow"><Icons.arrowRight /></span>
                            <span className="goal-next-text">{next.title}</span>
                          </div>
                        )}
                      </div>
                    </div>
                  );
                }) : (
                  <div className="empty-state">
                    <div className="empty-emoji" style={{color: 'var(--accent)'}}>
                      {searchQuery ? <Icons.search /> : <Icons.target />}
                    </div>
                    <h3 className="empty-title">{searchQuery ? 'No goals found' : 'No goals yet'}</h3>
                    <p className="empty-text">
                      {searchQuery 
                        ? `No goals match "${searchQuery}". Try a different search.`
                        : 'Tap "New Goal" to set your first goal and let AI create your action plan!'}
                    </p>
                  </div>
                )}
              </div>

              {/* Level Card - Moved to bottom */}
              {!searchQuery && (() => {
                const currentLevel = getLevel(userPoints);
                const nextLevel = getNextLevel(userPoints);
                const LevelIcon = Icons[currentLevel.icon] || Icons.star;
                const progressToNext = nextLevel 
                  ? ((userPoints - currentLevel.minPoints) / (nextLevel.minPoints - currentLevel.minPoints)) * 100
                  : 100;
                
                return (
                  <div className="level-card">
                    <div className="level-header">
                      <div className="level-info">
                        <div className="level-badge"><LevelIcon /></div>
                        <div>
                          <p className="level-number">Level {currentLevel.level}</p>
                          <h3 className="level-title">{currentLevel.name}</h3>
                        </div>
                      </div>
                      <div className="level-points">
                        <p className="level-points-value">{userPoints}</p>
                        <p className="level-points-label">points</p>
                      </div>
                    </div>
                    <div className="level-progress">
                      <div className="level-progress-bar">
                        <div className="level-progress-fill" style={{width: `${progressToNext}%`}} />
                      </div>
                      <div className="level-progress-text">
                        <span>{currentLevel.minPoints} XP</span>
                        <span>{nextLevel ? `${nextLevel.minPoints} XP` : 'MAX'}</span>
                      </div>
                    </div>
                  </div>
                );
              })()}
              
              {/* Daily Bonus - Moved to bottom */}
              {!searchQuery && !dailyBonusClaimed && (
                <div className="daily-bonus-card" onClick={claimDailyBonus}>
                  <div className="daily-bonus-icon"><Icons.coins /></div>
                  <div className="daily-bonus-info">
                    <p className="daily-bonus-title">Daily Bonus Available!</p>
                    <p className="daily-bonus-desc">Claim +{POINTS.DAILY_BONUS} points</p>
                  </div>
                  <button className="daily-bonus-btn">Claim</button>
                </div>
              )}
              
              {/* Streak Card - Moved to bottom */}
              {!searchQuery && (
                <div className="streak-card">
                  <div className="streak-header">
                    <div className="streak-info">
                      <div className="streak-icon"><Icons.flame /></div>
                      <div>
                        <p className="streak-label">Current Streak</p>
                        <p className="streak-value">{streakData.current} day{streakData.current !== 1 ? 's' : ''}</p>
                      </div>
                    </div>
                    <div className="streak-best">
                      <p className="streak-best-label">Best</p>
                      <p className="streak-best-value">{streakData.best} days</p>
                    </div>
                  </div>
                  <div className="streak-days">
                    {[...Array(7)].map((_, i) => {
                      const isActive = i < streakData.current;
                      const isToday = i === streakData.current - 1 || (streakData.current === 0 && i === 0);
                      return (
                        <div 
                          key={i} 
                          className={`streak-day ${isActive ? 'active' : ''} ${isToday && streakData.current > 0 ? 'today' : ''}`} 
                        />
                      );
                    })}
                  </div>
                </div>
              )}

              {!searchQuery && (
                <div className="section">
                  <div className="section-header">
                    <h2 className="section-title">Achievements</h2>
                    <span style={{fontSize: '13px', color: 'var(--text-dim)'}}>{unlockedAchievements.length}/{ACHIEVEMENTS.length}</span>
                  </div>
                  <div className="achievements-scroll">
                    {ACHIEVEMENTS.map(ach => {
                      const isUnlocked = unlockedAchievements.includes(ach.id);
                      const IconComp = Icons[ach.icon] || Icons.star;
                      return (
                        <div key={ach.id} className={`achievement-card ${isUnlocked ? '' : 'locked'}`} style={{background: ach.gradient}}>
                          <div className="achievement-icon"><IconComp /></div>
                          <h4 className="achievement-title">{ach.name}</h4>
                          <p className="achievement-desc">{ach.desc}</p>
                          <p className="achievement-date">{isUnlocked ? ' Unlocked' : ' Locked'}</p>
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>

            <button className="fab" onClick={() => handlePremiumFeature('goal', () => setView('new'))}>
              <span className="fab-icon"><Icons.plus /></span> New Goal
              {!isPremium && goals.length >= PREMIUM_CONFIG.FREE_GOAL_LIMIT - 1 && goals.length < PREMIUM_CONFIG.FREE_GOAL_LIMIT && (
                <span style={{marginLeft: '8px', fontSize: '11px', opacity: 0.8}}>({PREMIUM_CONFIG.FREE_GOAL_LIMIT - goals.length} left)</span>
              )}
            </button>
            
            {/* Points Popup */}
            {showPointsPopup && (
              <div className="points-popup">
                <Icons.coins /> {showPointsPopup.reason}
              </div>
            )}
            
            {/* Level Up Modal */}
            {showLevelUp && (
              <div className="levelup-modal" onClick={() => setShowLevelUp(null)}>
                <div className="levelup-card fade-in" onClick={e => e.stopPropagation()}>
                  <div className="levelup-icon">
                    {Icons[showLevelUp.icon] ? React.createElement(Icons[showLevelUp.icon]) : <Icons.star />}
                  </div>
                  <h2 className="levelup-title">Level Up!</h2>
                  <p className="levelup-level">You reached Level {showLevelUp.level}: {showLevelUp.name}</p>
                  <div className="levelup-rewards">
                    <div className="levelup-reward">
                      <Icons.trophy /> New title unlocked!
                    </div>
                  </div>
                  <button className="levelup-btn" onClick={() => setShowLevelUp(null)}>
                    Awesome!
                  </button>
                </div>
              </div>
            )}
            
            {/* Premium Paywall Modal */}
            {showPaywall && (
              <div className="paywall-modal" onClick={() => setShowPaywall(false)}>
                <div className="paywall-content" onClick={e => e.stopPropagation()}>
                  <button className="paywall-close" onClick={() => setShowPaywall(false)}><Icons.x /></button>
                  
                  <div className="paywall-badge">
                    <Icons.crown /> Premium
                  </div>
                  
                  <h2 className="paywall-title">Unlock Your Full Potential</h2>
                  <p className="paywall-subtitle">Get unlimited access to all features and achieve your goals faster with AI-powered guidance.</p>
                  
                  <div className="paywall-features">
                    {PREMIUM_CONFIG.FEATURES.map((feature, i) => {
                      const FeatureIcon = Icons[feature.icon] || Icons.star;
                      return (
                        <div key={i} className="paywall-feature">
                          <div className="paywall-feature-icon"><FeatureIcon /></div>
                          <div className="paywall-feature-text">
                            <h4>{feature.title}</h4>
                            <p>{feature.desc}</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  
                  <div className="paywall-plans">
                    {(() => {
                      const monthlyPerYear = PREMIUM_CONFIG.PLANS.monthly.priceNum * 12;
                      const yearlySavings = Math.round(((monthlyPerYear - PREMIUM_CONFIG.PLANS.yearly.priceNum) / monthlyPerYear) * 100);
                      return (
                        <>
                          <div 
                            className={`paywall-plan ${selectedPlan === 'weekly' ? 'selected' : ''}`}
                            onClick={() => setSelectedPlan('weekly')}
                          >
                            <p className="paywall-plan-period">Weekly</p>
                            <p className="paywall-plan-price">{PREMIUM_CONFIG.PLANS.weekly.price}<span>/wk</span></p>
                          </div>
                          <div 
                            className={`paywall-plan ${selectedPlan === 'monthly' ? 'selected' : ''}`}
                            onClick={() => setSelectedPlan('monthly')}
                          >
                            <p className="paywall-plan-period">Monthly</p>
                            <p className="paywall-plan-price">{PREMIUM_CONFIG.PLANS.monthly.price}<span>/mo</span></p>
                          </div>
                          <div 
                            className={`paywall-plan ${selectedPlan === 'yearly' ? 'selected' : ''}`}
                            onClick={() => setSelectedPlan('yearly')}
                          >
                            <div className="paywall-plan-badge">Best Value</div>
                            <p className="paywall-plan-period">Yearly</p>
                            <p className="paywall-plan-price">{PREMIUM_CONFIG.PLANS.yearly.price}<span>/yr</span></p>
                            <p className="paywall-plan-savings">Save {yearlySavings}%</p>
                          </div>
                        </>
                      );
                    })()}
                  </div>
                  
                  <button className="paywall-cta" onClick={handlePurchase}>
                    Start Free Trial
                  </button>
                  
                  <p className="paywall-terms">
                    3-day free trial, then {PREMIUM_CONFIG.PLANS[selectedPlan].price}/{PREMIUM_CONFIG.PLANS[selectedPlan].period}. Cancel anytime.<br/>
                    <a href="#">Terms of Service</a>  <a href="#">Privacy Policy</a>
                  </p>
                  
                  <button className="paywall-restore" onClick={restorePurchases}>
                    Restore Purchases
                  </button>
                </div>
              </div>
            )}
          </div>
        );
      }

      // NEW GOAL
      if (view === 'new') {
        const hasAnsweredQuestions = goalQuestions && Object.keys(goalQuestions.answers).length > 0;
        
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <button className="header-back" onClick={() => { resetGoalForm(); setView('dashboard'); }}><Icons.arrowLeft /></button>
                <span className="header-title">New Goal</span>
              </div>
            </header>
            <div className="new-goal-view fade-in">
              <div className="input-group">
                <label className="input-label">What do you want to achieve?</label>
                <input 
                  className="text-input" 
                  placeholder="e.g., Learn to play guitar..." 
                  value={newGoal} 
                  onChange={e => { setNewGoal(e.target.value); setGoalQuestions(null); }} 
                  disabled={loading} 
                  autoFocus 
                />
              </div>
              
              {/* AI Questions Section */}
              {newGoal.trim() && !goalQuestions && !questionsLoading && (
                <button 
                  className="questions-generate-btn"
                  onClick={() => generateQuestions(newGoal)}
                  disabled={loading}
                >
                  <Icons.sparkles /> Get personalized questions from AI
                </button>
              )}
              
              {questionsLoading && (
                <div className="questions-section">
                  <div className="questions-loading">
                    <span className="spin" style={{fontSize: '20px', color: 'var(--accent)'}}></span>
                    AI is thinking of questions...
                  </div>
                </div>
              )}
              
              {goalQuestions && (
                <div className="questions-section">
                  <div className="questions-header">
                    <div className="questions-icon"><Icons.sparkles /></div>
                    <div>
                      <h3 className="questions-title">Help AI understand better</h3>
                      <p className="questions-subtitle">Answer to get a more personalized plan</p>
                    </div>
                  </div>
                  
                  {goalQuestions.questions.map((q, i) => (
                    <div key={q.id} className="question-item">
                      <label className="question-label">
                        <span className="question-number">{i + 1}</span>
                        {q.question}
                      </label>
                      <input
                        className="question-input"
                        placeholder={q.placeholder}
                        value={goalQuestions.answers[q.id] || ''}
                        onChange={(e) => updateQuestionAnswer(q.id, e.target.value)}
                        disabled={loading}
                      />
                    </div>
                  ))}
                  
                  <div className="questions-skip">
                    <button className="questions-skip-btn" onClick={() => setGoalQuestions(null)}>
                      Skip questions
                    </button>
                  </div>
                </div>
              )}
              
              <div className="input-group">
                <label className="input-label">Target completion date (optional)</label>
                <input 
                  className="text-input" 
                  type="date" 
                  value={newGoalDueDate} 
                  onChange={e => setNewGoalDueDate(e.target.value)} 
                  disabled={loading}
                  min={new Date().toISOString().split('T')[0]}
                />
              </div>
              
              {/* Location Status */}
              {userLocation ? (
                <div style={{display: 'flex', alignItems: 'center', gap: '8px', padding: '12px 16px', background: 'var(--success-soft)', borderRadius: '12px', marginBottom: '20px'}}>
                  <Icons.mapPin style={{width: '18px', height: '18px', color: 'var(--success)'}} />
                  <span style={{fontSize: '14px', color: 'var(--success)', fontWeight: '500'}}>Location enabled</span>
                  <span style={{fontSize: '13px', color: 'var(--text-dim)', marginLeft: '4px'}}> AI will suggest nearby resources</span>
                </div>
              ) : (
                <button
                  type="button"
                  onClick={requestLocation}
                  disabled={locationLoading}
                  style={{
                    display: 'flex', alignItems: 'center', gap: '10px',
                    width: '100%', padding: '14px 16px',
                    background: 'var(--bg-card)', border: '1px dashed var(--border)',
                    borderRadius: '12px', marginBottom: '20px',
                    cursor: 'pointer', fontFamily: 'inherit'
                  }}
                >
                  <div style={{width: '36px', height: '36px', background: 'var(--accent-soft)', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--accent)'}}>
                    <Icons.mapPin />
                  </div>
                  <div style={{flex: 1, textAlign: 'left'}}>
                    <p style={{fontSize: '14px', fontWeight: '600', color: 'var(--text)'}}>
                      {locationLoading ? 'Getting location...' : 'Enable Location'}
                    </p>
                    <p style={{fontSize: '12px', color: 'var(--text-dim)'}}>Get personalized nearby suggestions</p>
                  </div>
                  {locationLoading && <span className="spin" style={{color: 'var(--accent)'}}></span>}
                </button>
              )}
              
              <div className="suggestions">
                <p className="suggestions-label">Suggestions</p>
                <div className="chips">
                  {suggestions.map(s => <button key={s} className="chip" onClick={() => { setNewGoal(s); setGoalQuestions(null); }} disabled={loading}>{s}</button>)}
                </div>
              </div>
              {error && <p className="error-msg">{error}</p>}
              <button className="primary-btn" onClick={createGoal} disabled={!newGoal.trim() || loading}>
                {loading ? <><span className="spin"></span> Generating...</> : <><Icons.sparkles /> Generate Plan {hasAnsweredQuestions ? '(Personalized)' : ''}</>}
              </button>
            </div>
          </div>
        );
      }

      // GOAL DETAIL
      if (view === 'detail' && activeGoal) {
        const goal = goals.find(g => g.id === activeGoal.id) || activeGoal;
        const progress = getProgress(goal);
        const dueDateInfo = getDueDateStatus(goal.dueDate);
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <button className="header-back" onClick={() => setView('dashboard')}><Icons.arrowLeft /></button>
                <span className="header-title">Goal Details</span>
              </div>
              <div className="header-right">
                <button className="goal-share-btn" onClick={() => handlePremiumFeature('share', () => shareGoal(goal))} title={isPremium ? "Share goal" : "Premium feature"}>
                  <Icons.share />
                </button>
                <button className="header-icon" onClick={() => setEditModal({ type: 'goal', goalId: goal.id, data: { name: goal.name, dueDate: goal.dueDate || '' } })}>
                  <Icons.edit />
                </button>
              </div>
            </header>
            <div className="detail-view fade-in">
              <div className="detail-card">
                <div className="detail-header">
                  <div className="detail-icon" style={{color: goal.iconColor?.color || 'var(--accent)'}}>
                    {Icons[goal.iconKey] ? React.createElement(Icons[goal.iconKey]) : <Icons.target />}
                  </div>
                  <div className="detail-info">
                    <h2 className="detail-name">{goal.name}</h2>
                    <p className="detail-meta">{goal.category || 'Personal Goal'}  {goal.createdAt || 'Recently'}</p>
                    {dueDateInfo && (
                      <div className={`due-date-badge ${dueDateInfo.status}`} style={{marginTop: '8px'}}>
                        <Icons.calendar /> {dueDateInfo.text}
                      </div>
                    )}
                  </div>
                </div>
                <div className="detail-progress">
                  <div className="detail-progress-circle">
                    <CircleProgress percent={progress} />
                    <span className="detail-progress-text">{progress}%</span>
                  </div>
                  <div className="detail-progress-info">
                    <p className="detail-progress-label">Progress</p>
                    <p className="detail-progress-value">{goal.completedSteps.length} of {goal.steps.length} steps done</p>
                  </div>
                </div>
              </div>

              <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px'}}>
                <h3 style={{fontSize: '18px', fontWeight: '700', margin: 0}}>Action Steps</h3>
                <button 
                  className="aclio-chat-btn"
                  onClick={() => handlePremiumFeature('chat', () => openAclioChat(goal))}
                  title={isPremium ? "Talk to Aclio" : "Premium feature"}
                >
                  <Icons.sparkles /> Talk to Aclio {!isPremium && <Icons.crown style={{width: '12px', height: '12px', marginLeft: '4px'}} />}
                </button>
              </div>
              <div className="steps-list">
                {goal.steps.map((step, i) => {
                  const isDone = goal.completedSteps.includes(step.id);
                  return (
                    <div key={step.id} className={`step-item slide-up ${isDone ? 'done' : ''}`} style={{animationDelay: `${i*0.05}s`}}>
                      <div className="step-check" onClick={() => toggleStep(goal.id, step.id)}>{isDone && <Icons.check />}</div>
                      <div className="step-body" onClick={() => toggleStep(goal.id, step.id)}>
                        <p className="step-num">Step {step.id}</p>
                        <h4 className="step-title">{step.title}</h4>
                        <p className="step-desc">{step.description}</p>
                        <p className="step-dur"><Icons.clock /> {step.duration}</p>
                        <div style={{display: 'flex', flexWrap: 'wrap', gap: '0'}}>
                          {step.mapSearch && (
                            <a 
                              href={`https://www.google.com/maps/search/${encodeURIComponent(step.mapSearch)}`}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="map-link-btn"
                              onClick={(e) => e.stopPropagation()}
                            >
                              <Icons.mapPin /> Find Nearby
                            </a>
                          )}
                          <button
                            className={`expand-btn ${expandedSteps[`${goal.id}-${step.id}`] ? 'view' : ''}`}
                            onClick={(e) => { 
                              e.stopPropagation(); 
                              // If already expanded, just view it
                              if (expandedSteps[`${goal.id}-${step.id}`]) {
                                expandStep(goal.id, step, goal.name);
                              } else {
                                handlePremiumFeature('expand', () => {
                                  trackExpandUse();
                                  expandStep(goal.id, step, goal.name);
                                });
                              }
                            }}
                          >
                            {expandedSteps[`${goal.id}-${step.id}`] ? (
                              <><Icons.eye /> View Resources</>
                            ) : (
                              <><Icons.sparkles /> Expand {!isPremium && `(${PREMIUM_CONFIG.FREE_EXPAND_DAILY - expandUsesToday} left)`}</>
                            )}
                          </button>
                          {canDoItForMe(step.title, step.description) && (
                            <button
                              className={`doitforme-btn ${savedDoItForMe[`${goal.id}-${step.id}`] ? 'done' : ''}`}
                              onClick={(e) => { 
                                e.stopPropagation(); 
                                // If already saved, just view it
                                if (savedDoItForMe[`${goal.id}-${step.id}`]) {
                                  doItForMe(goal.id, step, goal.name);
                                } else {
                                  handlePremiumFeature('doitforme', () => {
                                    trackDoItForMeUse();
                                    doItForMe(goal.id, step, goal.name);
                                  });
                                }
                              }}
                            >
                              {savedDoItForMe[`${goal.id}-${step.id}`] ? (
                                <><Icons.check /> View Result</>
                              ) : (
                                <><Icons.wand /> Do it for me {!isPremium && `(${PREMIUM_CONFIG.FREE_DOITFORME_DAILY - doItForMeUsesToday} left)`}</>
                              )}
                            </button>
                          )}
                        </div>
                      </div>
                      <button 
                        style={{background: 'none', border: 'none', padding: '8px', cursor: 'pointer', color: 'var(--text-dim)'}}
                        onClick={(e) => { e.stopPropagation(); setEditModal({ type: 'step', goalId: goal.id, stepId: step.id, data: { title: step.title, description: step.description, duration: step.duration } }); }}
                      >
                        <Icons.edit />
                      </button>
                    </div>
                  );
                })}
              </div>
              <button className="delete-btn" onClick={() => deleteGoal(goal.id)}>Delete Goal</button>
            </div>

            {showCelebration && (
              <div className="modal-overlay">
                <div className="modal-card fade-in">
                  <div className="modal-emoji" style={{fontSize: '56px'}}></div>
                  <h2 className="modal-title">Goal Complete!</h2>
                  <p className="modal-text">Amazing work! You crushed every step. Time to celebrate and share!</p>
                  <div style={{display: 'flex', flexDirection: 'column', gap: '12px', marginTop: '20px'}}>
                    <button className="primary-btn" style={{background: 'linear-gradient(135deg, #667eea, #764ba2)'}} onClick={() => { setShowCelebration(false); shareGoal(goal); }}>
                      <Icons.share /> Share Your Achievement
                    </button>
                    <button className="modal-btn" style={{background: 'var(--border)', color: 'var(--text)'}} onClick={() => { setShowCelebration(false); setView('dashboard'); }}>
                      Back to Dashboard
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Do It For Me Modal */}
            {doItForMeModal && (
              <div className="doitforme-modal" onClick={() => setDoItForMeModal(null)}>
                <div className="doitforme-modal-content fade-in" onClick={e => e.stopPropagation()}>
                  <div className="doitforme-modal-header">
                    <div className="doitforme-modal-icon"><Icons.wand /></div>
                    <div>
                      <h2 className="doitforme-modal-title">{doItForMeModal.step?.title}</h2>
                      <p className="doitforme-modal-subtitle">AI-generated result</p>
                    </div>
                    <button className="doitforme-modal-close" onClick={() => setDoItForMeModal(null)}><Icons.x /></button>
                  </div>
                  
                  <div className="doitforme-modal-body">
                    {doItForMeModal.loading ? (
                      <div className="doitforme-loading">
                        <div className="doitforme-loading-icon"><span className="spin"></span></div>
                        <p className="doitforme-loading-text">AI is working on this...</p>
                        <p className="doitforme-loading-subtext">Creating your {doItForMeModal.step?.title.toLowerCase()}</p>
                      </div>
                    ) : doItForMeModal.error ? (
                      <div style={{textAlign: 'center', padding: '40px 20px'}}>
                        <p style={{color: 'var(--red)', marginBottom: '16px'}}>{doItForMeModal.error}</p>
                        <button className="primary-btn" style={{maxWidth: '200px', margin: '0 auto'}} onClick={() => doItForMe(doItForMeModal.goalId, doItForMeModal.step, doItForMeModal.goalName)}>
                          Try Again
                        </button>
                      </div>
                    ) : doItForMeModal.result ? (
                      <>
                        {savedDoItForMe[`${doItForMeModal.goalId}-${doItForMeModal.stepId}`] && (
                          <div className="doitforme-saved-badge">
                            <Icons.check /> Saved
                          </div>
                        )}
                        <div className="doitforme-result">
                          {doItForMeModal.result.split('\n').map((line, i) => {
                            // Simple markdown-like formatting
                            if (line.startsWith('## ')) return <h2 key={i}>{line.slice(3)}</h2>;
                            if (line.startsWith('# ')) return <h1 key={i}>{line.slice(2)}</h1>;
                            if (line.startsWith('**') && line.endsWith('**')) return <h3 key={i}>{line.slice(2, -2)}</h3>;
                            if (line.startsWith('- ')) return <li key={i} style={{marginLeft: '20px'}}>{line.slice(2)}</li>;
                            if (line.match(/^\d+\./)) return <li key={i} style={{marginLeft: '20px'}}>{line}</li>;
                            if (line.includes('|')) {
                              const cells = line.split('|').filter(c => c.trim());
                              if (cells.length > 1) {
                                return (
                                  <div key={i} style={{display: 'flex', borderBottom: '1px solid var(--border)', padding: '8px 0'}}>
                                    {cells.map((cell, j) => (
                                      <span key={j} style={{flex: 1, fontSize: '13px'}}>{cell.trim()}</span>
                                    ))}
                                  </div>
                                );
                              }
                            }
                            if (line.trim() === '') return <br key={i} />;
                            return <p key={i} style={{marginBottom: '8px'}}>{line}</p>;
                          })}
                        </div>
                      </>
                    ) : null}
                  </div>
                  
                  {!doItForMeModal.loading && doItForMeModal.result && (
                    <div className="doitforme-modal-footer">
                      <button className="doitforme-action-btn" onClick={copyDoItForMeResult}>
                        <Icons.copy /> Copy
                      </button>
                      <button className="doitforme-action-btn" onClick={downloadDoItForMeResult}>
                        <Icons.download /> Download
                      </button>
                      {!savedDoItForMe[`${doItForMeModal.goalId}-${doItForMeModal.stepId}`] && (
                        <button className="doitforme-action-btn primary" onClick={saveDoItForMeResult}>
                          <Icons.bookmark /> Save
                        </button>
                      )}
                    </div>
                  )}
                </div>
              </div>
            )}
            
            {/* Expand Modal */}
            {expandModal && (
              <div className="expand-modal" onClick={() => setExpandModal(null)}>
                <div className="expand-modal-content fade-in" onClick={e => e.stopPropagation()}>
                  <div className="expand-modal-header">
                    <h2 className="expand-modal-title">{expandModal.step?.title || 'Step Details'}</h2>
                    <button className="edit-modal-close" onClick={() => setExpandModal(null)}><Icons.x /></button>
                  </div>
                  
                  <div className="expand-modal-body">
                    {expandModal.loading ? (
                      <div className="expand-loading">
                        <div className="expand-loading-spinner spin"></div>
                        <p className="expand-loading-text">Finding resources and creating your guide...</p>
                      </div>
                    ) : expandModal.error ? (
                      <div style={{textAlign: 'center', padding: '40px 20px'}}>
                        <p style={{color: 'var(--red)', marginBottom: '16px'}}>{expandModal.error}</p>
                        <button className="primary-btn" style={{maxWidth: '200px', margin: '0 auto'}} onClick={() => expandStep(expandModal.goalId, expandModal.step, expandModal.goalName)}>
                          Try Again
                        </button>
                      </div>
                    ) : expandModal.content ? (
                      <>
                        {/* Detailed Guide */}
                        <div className="expand-section">
                          <h3 className="expand-section-title"><Icons.book /> Detailed Guide</h3>
                          <p className="expand-text" style={{whiteSpace: 'pre-line'}}>{expandModal.content.detailedGuide}</p>
                        </div>
                        
                        {/* Resources */}
                        {expandModal.content.resources?.length > 0 && (
                          <div className="expand-section">
                            <h3 className="expand-section-title"><Icons.link /> Recommended Resources</h3>
                            {expandModal.content.resources.map((resource, i) => (
                              <a 
                                key={i} 
                                href={resource.url} 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="expand-resource"
                              >
                                <div className="expand-resource-icon">
                                  {resource.type === 'video' ? <Icons.star /> : 
                                   resource.type === 'course' ? <Icons.book /> :
                                   resource.type === 'app' ? <Icons.code /> :
                                   <Icons.externalLink />}
                                </div>
                                <div className="expand-resource-info">
                                  <p className="expand-resource-name">{resource.name}</p>
                                  <p className="expand-resource-desc">{resource.description}</p>
                                  <p className="expand-resource-meta">
                                    <span style={{textTransform: 'capitalize'}}>{resource.type}</span>
                                    {resource.cost && <>  {resource.cost}</>}
                                  </p>
                                </div>
                              </a>
                            ))}
                          </div>
                        )}
                        
                        {/* Tips */}
                        {expandModal.content.tips?.length > 0 && (
                          <div className="expand-section">
                            <h3 className="expand-section-title"><Icons.zap /> Pro Tips</h3>
                            {expandModal.content.tips.map((tip, i) => (
                              <div key={i} className="expand-tip">
                                <span className="expand-tip-icon"><Icons.star /></span>
                                <p className="expand-tip-text">{tip}</p>
                              </div>
                            ))}
                          </div>
                        )}
                        
                        {/* Search for more */}
                        {expandModal.content.searchQuery && (
                          <div className="expand-section">
                            <a 
                              href={`https://www.google.com/search?q=${encodeURIComponent(expandModal.content.searchQuery)}`}
                              target="_blank"
                              rel="noopener noreferrer"
                              style={{
                                display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px',
                                padding: '14px', background: 'var(--bg)', border: '1px dashed var(--border)',
                                borderRadius: '12px', color: 'var(--text-dim)', textDecoration: 'none',
                                fontSize: '14px', fontWeight: '500'
                              }}
                            >
                              <Icons.search /> Search for more resources
                            </a>
                          </div>
                        )}
                      </>
                    ) : null}
                  </div>
                  
                  {!expandModal.loading && expandModal.content && (
                    <div className="expand-modal-footer">
                      <button className="edit-btn-cancel" onClick={() => setExpandModal(null)}>Close</button>
                      {!expandedSteps[`${expandModal.goalId}-${expandModal.stepId}`] && (
                        <button className="edit-btn-save" onClick={saveExpandedContent}>
                          <Icons.bookmark style={{width: '16px', height: '16px', marginRight: '6px'}} /> Save Resources
                        </button>
                      )}
                    </div>
                  )}
                </div>
              </div>
            )}
            
            {/* Talk to Aclio Chat Modal */}
            {showAclioChat && (
              <div className="aclio-chat-modal" onClick={() => setShowAclioChat(false)}>
                <div className="aclio-chat-content" onClick={e => e.stopPropagation()}>
                  <div className="aclio-chat-header">
                    <div className="aclio-chat-avatar">
                      <img src="/mascot.png" alt="Aclio" style={{width: '100%', height: '100%', objectFit: 'contain'}} />
                    </div>
                    <div>
                      <h2 className="aclio-chat-title">Talk to Aclio</h2>
                      <p className="aclio-chat-subtitle">Your AI goal coach</p>
                    </div>
                    <button className="aclio-chat-close" onClick={() => setShowAclioChat(false)}><Icons.x /></button>
                  </div>
                  
                  <div className="aclio-chat-messages">
                    {aclioChatHistory.map((msg, i) => (
                      <div key={i} className={`aclio-message ${msg.role}`}>
                        {msg.role === 'assistant' && (
                          <div className="aclio-message-avatar"></div>
                        )}
                        <div className="aclio-message-bubble">
                          {msg.content}
                        </div>
                      </div>
                    ))}
                    {aclioLoading && (
                      <div className="aclio-message assistant">
                        <div className="aclio-message-avatar"></div>
                        <div className="aclio-message-bubble">
                          <span className="aclio-typing">Thinking<span>.</span><span>.</span><span>.</span></span>
                        </div>
                      </div>
                    )}
                  </div>
                  
                  <div className="aclio-chat-input-container">
                    <input
                      className="aclio-chat-input"
                      type="text"
                      placeholder="Ask for guidance, more steps, or share context..."
                      value={aclioMessage}
                      onChange={(e) => setAclioMessage(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && !aclioLoading && sendAclioMessage(goal)}
                      disabled={aclioLoading}
                    />
                    <button 
                      className="aclio-chat-send"
                      onClick={() => sendAclioMessage(goal)}
                      disabled={aclioLoading || !aclioMessage.trim()}
                    >
                      <Icons.send />
                    </button>
                  </div>
                  
                  <div className="aclio-quick-prompts">
                    <button onClick={() => { setAclioMessage("Can you add more detailed steps?"); }}>Add more steps</button>
                    <button onClick={() => { setAclioMessage("I'm struggling with this goal. Any tips?"); }}>I need help</button>
                    <button onClick={() => { setAclioMessage("What should I focus on first?"); }}>What's next?</button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Edit Modal */}
            {editModal && (
              <div className="edit-modal" onClick={() => setEditModal(null)}>
                <div className="edit-modal-content" onClick={e => e.stopPropagation()}>
                  <div className="edit-modal-header">
                    <h2 className="edit-modal-title">{editModal.type === 'goal' ? 'Edit Goal' : 'Edit Step'}</h2>
                    <button className="edit-modal-close" onClick={() => setEditModal(null)}><Icons.x /></button>
                  </div>
                  
                  {editModal.type === 'goal' && (
                    <>
                      <div className="edit-field">
                        <label className="edit-label">Goal Name</label>
                        <input 
                          className="edit-input" 
                          value={editModal.data.name}
                          onChange={(e) => setEditModal({...editModal, data: {...editModal.data, name: e.target.value}})}
                        />
                      </div>
                      <div className="edit-field">
                        <label className="edit-label">Due Date</label>
                        <input 
                          className="edit-input" 
                          type="date"
                          value={editModal.data.dueDate}
                          onChange={(e) => setEditModal({...editModal, data: {...editModal.data, dueDate: e.target.value}})}
                        />
                      </div>
                      <div className="edit-actions">
                        <button className="edit-btn-cancel" onClick={() => setEditModal(null)}>Cancel</button>
                        <button className="edit-btn-save" onClick={() => updateGoal(editModal.goalId, editModal.data)}>Save Changes</button>
                      </div>
                    </>
                  )}
                  
                  {editModal.type === 'step' && (
                    <>
                      <div className="edit-field">
                        <label className="edit-label">Step Title</label>
                        <input 
                          className="edit-input" 
                          value={editModal.data.title}
                          onChange={(e) => setEditModal({...editModal, data: {...editModal.data, title: e.target.value}})}
                        />
                      </div>
                      <div className="edit-field">
                        <label className="edit-label">Description</label>
                        <textarea 
                          className="edit-textarea" 
                          value={editModal.data.description}
                          onChange={(e) => setEditModal({...editModal, data: {...editModal.data, description: e.target.value}})}
                        />
                      </div>
                      <div className="edit-field">
                        <label className="edit-label">Duration</label>
                        <input 
                          className="edit-input" 
                          value={editModal.data.duration}
                          placeholder="e.g., 2 hours, 1 week"
                          onChange={(e) => setEditModal({...editModal, data: {...editModal.data, duration: e.target.value}})}
                        />
                      </div>
                      <div className="edit-actions">
                        <button className="edit-btn-cancel" onClick={() => setEditModal(null)}>Cancel</button>
                        <button className="edit-btn-save" onClick={() => updateStep(editModal.goalId, editModal.stepId, editModal.data)}>Save Changes</button>
                      </div>
                    </>
                  )}
                </div>
              </div>
            )}
            
            {/* Share Modal */}
            {shareModal && (
              <div className="share-modal" onClick={() => setShareModal(null)}>
                <div className="share-card-container" onClick={e => e.stopPropagation()}>
                  <button className="share-close" onClick={() => setShareModal(null)}><Icons.x /></button>
                  
                  <div className="share-card" ref={shareCardRef}>
                    <div className="share-card-content">
                      {shareModal.isCompleted && <div className="share-card-confetti"></div>}
                      <div className="share-card-badge">
                        {shareModal.isCompleted ? '' : ''}
                      </div>
                      <h2 className="share-card-title">
                        {shareModal.isCompleted ? 'Goal Achieved!' : 'Working On It!'}
                      </h2>
                      <p className="share-card-subtitle">
                        {shareModal.isCompleted ? 'I crushed this goal!' : 'Making progress every day'}
                      </p>
                      <div className="share-card-goal">
                        <p className="share-card-goal-label">My Goal</p>
                        <p className="share-card-goal-name">{shareModal.goal.name}</p>
                      </div>
                      <div className="share-card-stats">
                        <div className="share-card-stat">
                          <p className="share-card-stat-value">{shareModal.goal.steps?.length || 0}</p>
                          <p className="share-card-stat-label">Steps</p>
                        </div>
                        <div className="share-card-stat">
                          <p className="share-card-stat-value">{getProgress(shareModal.goal)}%</p>
                          <p className="share-card-stat-label">Complete</p>
                        </div>
                        {shareModal.isCompleted && (
                          <div className="share-card-stat">
                            <p className="share-card-stat-value"></p>
                            <p className="share-card-stat-label">Done!</p>
                          </div>
                        )}
                      </div>
                      <div className="share-card-logo">
                        <Icons.target /> Aclio
                      </div>
                    </div>
                  </div>
                  
                  <div className="share-actions">
                    <button className="share-btn download" onClick={downloadShareCard}>
                      <Icons.download /> Save Image
                    </button>
                    <button className="share-btn twitter" onClick={shareToTwitter}>
                      <Icons.twitter /> Twitter
                    </button>
                    <button className="share-btn whatsapp" onClick={shareToWhatsApp}>
                      <Icons.whatsapp /> WhatsApp
                    </button>
                    <button className="share-btn" onClick={copyShareLink}>
                      <Icons.copy /> Copy Text
                    </button>
                  </div>
                </div>
              </div>
            )}
            
            {/* Premium Paywall Modal - Goal Detail */}
            {showPaywall && (
              <div className="paywall-modal" onClick={() => setShowPaywall(false)}>
                <div className="paywall-content" onClick={e => e.stopPropagation()}>
                  <button className="paywall-close" onClick={() => setShowPaywall(false)}><Icons.x /></button>
                  
                  <div className="paywall-badge">
                    <Icons.crown /> Premium
                  </div>
                  
                  <h2 className="paywall-title">Unlock Your Full Potential</h2>
                  <p className="paywall-subtitle">Get unlimited access to all features and achieve your goals faster with AI-powered guidance.</p>
                  
                  <div className="paywall-features">
                    {PREMIUM_CONFIG.FEATURES.map((feature, i) => {
                      const FeatureIcon = Icons[feature.icon] || Icons.star;
                      return (
                        <div key={i} className="paywall-feature">
                          <div className="paywall-feature-icon"><FeatureIcon /></div>
                          <div className="paywall-feature-text">
                            <h4>{feature.title}</h4>
                            <p>{feature.desc}</p>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  
                  <div className="paywall-plans">
                    {(() => {
                      const monthlyPerYear = PREMIUM_CONFIG.PLANS.monthly.priceNum * 12;
                      const yearlySavings = Math.round(((monthlyPerYear - PREMIUM_CONFIG.PLANS.yearly.priceNum) / monthlyPerYear) * 100);
                      return (
                        <>
                          <div 
                            className={`paywall-plan ${selectedPlan === 'weekly' ? 'selected' : ''}`}
                            onClick={() => setSelectedPlan('weekly')}
                          >
                            <p className="paywall-plan-period">Weekly</p>
                            <p className="paywall-plan-price">{PREMIUM_CONFIG.PLANS.weekly.price}<span>/wk</span></p>
                          </div>
                          <div 
                            className={`paywall-plan ${selectedPlan === 'monthly' ? 'selected' : ''}`}
                            onClick={() => setSelectedPlan('monthly')}
                          >
                            <p className="paywall-plan-period">Monthly</p>
                            <p className="paywall-plan-price">{PREMIUM_CONFIG.PLANS.monthly.price}<span>/mo</span></p>
                          </div>
                          <div 
                            className={`paywall-plan ${selectedPlan === 'yearly' ? 'selected' : ''}`}
                            onClick={() => setSelectedPlan('yearly')}
                          >
                            <div className="paywall-plan-badge">Best Value</div>
                            <p className="paywall-plan-period">Yearly</p>
                            <p className="paywall-plan-price">{PREMIUM_CONFIG.PLANS.yearly.price}<span>/yr</span></p>
                            <p className="paywall-plan-savings">Save {yearlySavings}%</p>
                          </div>
                        </>
                      );
                    })()}
                  </div>
                  
                  <button className="paywall-cta" onClick={handlePurchase}>
                    Start Free Trial
                  </button>
                  
                  <p className="paywall-terms">
                    3-day free trial, then {PREMIUM_CONFIG.PLANS[selectedPlan].price}/{PREMIUM_CONFIG.PLANS[selectedPlan].period}. Cancel anytime.<br/>
                    <a href="#">Terms of Service</a>  <a href="#">Privacy Policy</a>
                  </p>
                  
                  <button className="paywall-restore" onClick={restorePurchases}>
                    Restore Purchases
                  </button>
                </div>
              </div>
            )}
          </div>
        );
      }
      
      // SETTINGS
      if (view === 'settings') {
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <button className="header-back" onClick={() => setView('dashboard')}><Icons.arrowLeft /></button>
                <span className="header-title">Settings</span>
              </div>
            </header>
            
            <div className="settings-view fade-in">
              <div className="settings-section">
                <h3 className="settings-section-title">Profile</h3>
                <div className="settings-card">
                  <div className="settings-item" onClick={() => setView('edit-profile')}>
                    <div className="settings-item-icon" style={{background: 'var(--accent-soft)', color: 'var(--accent)'}}>
                      <Icons.user />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">{userProfile?.name || 'Your Profile'}</p>
                      <p className="settings-item-desc">Edit your name, age, and gender</p>
                    </div>
                    <span className="settings-item-arrow"><Icons.chevronRight /></span>
                  </div>
                </div>
              </div>
              
              <div className="settings-section">
                <h3 className="settings-section-title">Preferences</h3>
                <div className="settings-card">
                  <div className="settings-item" onClick={toggleTheme}>
                    <div className="settings-item-icon" style={{background: 'var(--purple-soft)', color: 'var(--purple)'}}>
                      {theme === 'dark' ? <Icons.moon /> : <Icons.sun />}
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Dark Mode</p>
                      <p className="settings-item-desc">Toggle dark/light appearance</p>
                    </div>
                    <div className={`settings-item-toggle ${theme === 'dark' ? 'active' : ''}`} />
                  </div>
                  
                  <div className="settings-item" onClick={toggleNotifications}>
                    <div className="settings-item-icon" style={{background: 'var(--orange-soft)', color: 'var(--orange)'}}>
                      <Icons.bellRing />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Notifications</p>
                      <p className="settings-item-desc">Get reminders for your goals</p>
                    </div>
                    <div className={`settings-item-toggle ${notificationsEnabled ? 'active' : ''}`} />
                  </div>
                  
                  <div className="settings-item" onClick={userLocation ? clearLocation : requestLocation}>
                    <div className="settings-item-icon" style={{background: 'var(--success-soft)', color: 'var(--success)'}}>
                      <Icons.mapPin />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Location</p>
                      <p className="settings-item-desc">
                        {locationLoading ? 'Getting location...' : userLocation ? ` ${userLocation.display}` : 'Enable for nearby suggestions'}
                      </p>
                    </div>
                    {!locationLoading && (
                      <div className={`settings-item-toggle ${userLocation ? 'active' : ''}`} />
                    )}
                    {locationLoading && <span className="spin" style={{color: 'var(--accent)'}}></span>}
                  </div>
                </div>
              </div>
              
              <div className="settings-section">
                <h3 className="settings-section-title">Data</h3>
                <div className="settings-card">
                  <div className="settings-item" onClick={() => {
                    const data = JSON.stringify({ goals, profile: userProfile }, null, 2);
                    const blob = new Blob([data], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'achieve-ai-backup.json';
                    a.click();
                  }}>
                    <div className="settings-item-icon" style={{background: 'var(--success-soft)', color: 'var(--success)'}}>
                      <Icons.arrowRight style={{transform: 'rotate(-45deg)'}} />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Export Data</p>
                      <p className="settings-item-desc">Download your goals as JSON</p>
                    </div>
                    <span className="settings-item-arrow"><Icons.chevronRight /></span>
                  </div>
                  
                  <div className="settings-item settings-danger" onClick={() => {
                    if (confirm('Are you sure? This will delete ALL your goals and cannot be undone.')) {
                      setGoals([]);
                      localStorage.removeItem('achieve_goals');
                    }
                  }}>
                    <div className="settings-item-icon" style={{background: 'rgba(239,68,68,0.1)', color: 'var(--red)'}}>
                      <Icons.trash />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Clear All Goals</p>
                      <p className="settings-item-desc" style={{color: 'var(--text-dim)'}}>Permanently delete all data</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <div className="settings-section">
                <h3 className="settings-section-title">Developer</h3>
                <div className="settings-card">
                  <div className="settings-item" onClick={() => setView('error-log')}>
                    <div className="settings-item-icon" style={{background: errorStats.errors > 0 ? 'rgba(239,68,68,0.1)' : 'var(--success-soft)', color: errorStats.errors > 0 ? 'var(--red)' : 'var(--success)'}}>
                      <Icons.bug />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Error Log</p>
                      <p className="settings-item-desc">
                        {errorStats.total === 0 ? 'No issues detected' : `${errorStats.errors} errors, ${errorStats.warnings} warnings`}
                      </p>
                    </div>
                    <span className="settings-item-arrow"><Icons.chevronRight /></span>
                  </div>
                </div>
              </div>
              
              <div className="settings-section">
                <h3 className="settings-section-title">About</h3>
                <div className="settings-card">
                  <div className="settings-item">
                    <div className="settings-item-icon" style={{background: 'var(--accent-soft)', color: 'var(--accent)'}}>
                      <Icons.info />
                    </div>
                    <div className="settings-item-content">
                      <p className="settings-item-title">Aclio</p>
                      <p className="settings-item-desc">Version 1.0.0  Made with </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }
      
      // ANALYTICS DASHBOARD
      if (view === 'analytics') {
        // Calculate analytics data
        const totalGoals = goals.length;
        const completedGoals = goals.filter(g => getProgress(g) === 100);
        const totalSteps = goals.reduce((sum, g) => sum + g.steps.length, 0);
        const completedSteps = goals.reduce((sum, g) => sum + g.completedSteps.length, 0);
        const avgProgress = totalGoals > 0 ? Math.round(goals.reduce((sum, g) => sum + getProgress(g), 0) / totalGoals) : 0;
        
        // Calculate weekly data for chart (last 7 days)
        const today = new Date();
        const weekDays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        const chartData = [];
        for (let i = 6; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          const dayName = weekDays[date.getDay()];
          // For demo, simulate some activity data based on completed steps
          const stepsOnDay = Math.floor(Math.random() * (completedSteps / 7 + 2));
          chartData.push({ day: dayName, value: analyticsFilter === 'goals' ? Math.min(stepsOnDay, completedGoals.length) : stepsOnDay });
        }
        const maxChartValue = Math.max(...chartData.map(d => d.value), 1);
        
        // Days since first goal
        const firstGoalDate = goals.length > 0 ? new Date(goals[goals.length - 1].createdAt) : new Date();
        const daysSinceStart = Math.max(1, Math.ceil((today - firstGoalDate) / (1000 * 60 * 60 * 24)));
        
        // Completion rate
        const completionRate = totalSteps > 0 ? Math.round((completedSteps / totalSteps) * 100) : 0;
        
        // Average steps per goal
        const avgStepsPerGoal = totalGoals > 0 ? Math.round(totalSteps / totalGoals) : 0;
        
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <button className="header-back" onClick={() => setView('dashboard')}><Icons.arrowLeft /></button>
                <span className="header-title">Analytics</span>
              </div>
            </header>
            
            <div className="analytics-view fade-in">
              <div className="analytics-header">
                <h1 className="analytics-title">Your Progress</h1>
                <p className="analytics-subtitle">Track your journey since {goals.length > 0 ? goals[goals.length - 1].createdAt : 'you started'}</p>
              </div>
              
              {totalGoals === 0 ? (
                <div className="analytics-empty">
                  <div className="analytics-empty-icon"><Icons.barChart /></div>
                  <h3 className="analytics-empty-title">No data yet</h3>
                  <p className="analytics-empty-text">Create your first goal to start tracking your progress and achievements!</p>
                </div>
              ) : (
                <>
                  {/* Filter Tabs */}
                  <div className="analytics-tabs">
                    <button 
                      className={`analytics-tab ${analyticsFilter === 'goals' ? 'active' : ''}`}
                      onClick={() => setAnalyticsFilter('goals')}
                    >
                      Goals
                    </button>
                    <button 
                      className={`analytics-tab ${analyticsFilter === 'steps' ? 'active' : ''}`}
                      onClick={() => setAnalyticsFilter('steps')}
                    >
                      Steps
                    </button>
                  </div>
                  
                  {/* Stats Grid */}
                  <div className="stats-grid">
                    {analyticsFilter === 'goals' ? (
                      <>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--accent-soft)', color: 'var(--accent)'}}>
                            <Icons.target />
                          </div>
                          <div className="stat-value">{totalGoals}</div>
                          <div className="stat-label">Total Goals</div>
                        </div>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--success-soft)', color: 'var(--success)'}}>
                            <Icons.trophy />
                          </div>
                          <div className="stat-value">{completedGoals.length}</div>
                          <div className="stat-label">Completed</div>
                          {completedGoals.length > 0 && (
                            <div className="stat-change positive">
                              <Icons.trendingUp /> {Math.round((completedGoals.length / totalGoals) * 100)}% rate
                            </div>
                          )}
                        </div>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--purple-soft)', color: 'var(--purple)'}}>
                            <Icons.activity />
                          </div>
                          <div className="stat-value">{avgProgress}%</div>
                          <div className="stat-label">Avg. Progress</div>
                        </div>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--orange-soft)', color: 'var(--orange)'}}>
                            <Icons.calendar />
                          </div>
                          <div className="stat-value">{daysSinceStart}</div>
                          <div className="stat-label">Days Active</div>
                        </div>
                      </>
                    ) : (
                      <>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--accent-soft)', color: 'var(--accent)'}}>
                            <Icons.check />
                          </div>
                          <div className="stat-value">{completedSteps}</div>
                          <div className="stat-label">Steps Completed</div>
                          {completedSteps > 0 && (
                            <div className="stat-change positive">
                              <Icons.trendingUp /> {completionRate}% of all
                            </div>
                          )}
                        </div>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--purple-soft)', color: 'var(--purple)'}}>
                            <Icons.target />
                          </div>
                          <div className="stat-value">{totalSteps}</div>
                          <div className="stat-label">Total Steps</div>
                        </div>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--success-soft)', color: 'var(--success)'}}>
                            <Icons.zap />
                          </div>
                          <div className="stat-value">{avgStepsPerGoal}</div>
                          <div className="stat-label">Avg. per Goal</div>
                        </div>
                        <div className="stat-card">
                          <div className="stat-icon" style={{background: 'var(--gold-soft)', color: '#b45309'}}>
                            <Icons.flame />
                          </div>
                          <div className="stat-value">{totalSteps - completedSteps}</div>
                          <div className="stat-label">Remaining</div>
                        </div>
                      </>
                    )}
                  </div>
                  
                  {/* Progress Chart */}
                  <div className="chart-card">
                    <div className="chart-header">
                      <h3 className="chart-title">
                        {analyticsFilter === 'goals' ? 'Goals Activity' : 'Steps Activity'}
                      </h3>
                      <span className="chart-period">Last 7 days</span>
                    </div>
                    <div className="chart-bars">
                      {chartData.map((d, i) => (
                        <div key={i} className="chart-bar-wrap">
                          <div 
                            className="chart-bar" 
                            style={{
                              height: `${(d.value / maxChartValue) * 100}px`,
                              background: i === chartData.length - 1 ? 'var(--accent)' : 'var(--accent-soft)'
                            }}
                          />
                          <span className="chart-bar-label">{d.day}</span>
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  {/* Summary Card */}
                  <div className="chart-card" style={{background: 'linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%)', border: 'none', color: '#fff'}}>
                    <div style={{display: 'flex', alignItems: 'center', gap: '16px'}}>
                      <div style={{width: '56px', height: '56px', background: 'rgba(255,255,255,0.2)', borderRadius: '16px', display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
                        <Icons.award />
                      </div>
                      <div>
                        <h3 style={{fontSize: '18px', fontWeight: '700', marginBottom: '4px'}}>
                          {completedGoals.length > 0 
                            ? `You've completed ${completedGoals.length} goal${completedGoals.length > 1 ? 's' : ''}!`
                            : 'Keep going!'}
                        </h3>
                        <p style={{fontSize: '14px', opacity: 0.9}}>
                          {completedSteps > 0 
                            ? `${completedSteps} steps done in ${daysSinceStart} days`
                            : 'Complete your first step to see progress'}
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  {/* Completed Goals List */}
                  {completedGoals.length > 0 && (
                    <div className="completed-section">
                      <div className="completed-header">
                        <h3 className="completed-title">Completed Goals</h3>
                        <span className="completed-count">{completedGoals.length}</span>
                      </div>
                      {completedGoals.map(goal => {
                        const IconComponent = Icons[goal.iconKey] || Icons.target;
                        return (
                          <div key={goal.id} className="completed-goal">
                            <div className="completed-goal-icon" style={{background: goal.iconColor?.bg || 'var(--accent-soft)', color: goal.iconColor?.color || 'var(--accent)'}}>
                              <IconComponent />
                            </div>
                            <div className="completed-goal-info">
                              <h4 className="completed-goal-name">{goal.name}</h4>
                              <p className="completed-goal-meta">{goal.steps.length} steps  {goal.category}</p>
                            </div>
                            <div className="completed-goal-badge">
                              <Icons.check /> Done
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                  
                  {/* Gamification Stats */}
                  <div className="chart-card">
                    <div className="chart-header">
                      <h3 className="chart-title">Achievements</h3>
                    </div>
                    <div className="stats-grid" style={{marginBottom: 0}}>
                      <div className="stat-card">
                        <div className="stat-icon" style={{background: 'var(--gold-soft)', color: '#b45309'}}>
                          <Icons.coins />
                        </div>
                        <div className="stat-value">{userPoints}</div>
                        <div className="stat-label">Total Points</div>
                      </div>
                      <div className="stat-card">
                        <div className="stat-icon" style={{background: 'var(--purple-soft)', color: 'var(--purple)'}}>
                          <Icons.crown />
                        </div>
                        <div className="stat-value">{getLevel(userPoints).level}</div>
                        <div className="stat-label">{getLevel(userPoints).name}</div>
                      </div>
                      <div className="stat-card">
                        <div className="stat-icon" style={{background: 'var(--orange-soft)', color: 'var(--orange)'}}>
                          <Icons.flame />
                        </div>
                        <div className="stat-value">{streakData.current}</div>
                        <div className="stat-label">Day Streak</div>
                      </div>
                      <div className="stat-card">
                        <div className="stat-icon" style={{background: 'var(--success-soft)', color: 'var(--success)'}}>
                          <Icons.trophy />
                        </div>
                        <div className="stat-value">{streakData.best}</div>
                        <div className="stat-label">Best Streak</div>
                      </div>
                    </div>
                  </div>
                  
                  {/* In Progress Goals */}
                  {goals.filter(g => getProgress(g) < 100 && getProgress(g) > 0).length > 0 && (
                    <div className="completed-section">
                      <div className="completed-header">
                        <h3 className="completed-title">In Progress</h3>
                        <span className="completed-count">{goals.filter(g => getProgress(g) < 100 && getProgress(g) > 0).length}</span>
                      </div>
                      {goals.filter(g => getProgress(g) < 100 && getProgress(g) > 0).map(goal => {
                        const IconComponent = Icons[goal.iconKey] || Icons.target;
                        const progress = getProgress(goal);
                        return (
                          <div key={goal.id} className="completed-goal" onClick={() => { setActiveGoal(goal); setView('detail'); }} style={{cursor: 'pointer'}}>
                            <div className="completed-goal-icon" style={{background: goal.iconColor?.bg || 'var(--accent-soft)', color: goal.iconColor?.color || 'var(--accent)'}}>
                              <IconComponent />
                            </div>
                            <div className="completed-goal-info">
                              <h4 className="completed-goal-name">{goal.name}</h4>
                              <p className="completed-goal-meta">{goal.completedSteps.length}/{goal.steps.length} steps  {goal.category}</p>
                            </div>
                            <div style={{fontWeight: '700', color: 'var(--accent)'}}>{progress}%</div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </>
              )}
            </div>
          </div>
        );
      }
      
      // ERROR LOG VIEW
      if (view === 'error-log') {
        const errors = ErrorTracker.getErrors(errorFilter);
        const stats = ErrorTracker.getStats();
        
        const formatTime = (timestamp) => {
          const date = new Date(timestamp);
          const now = new Date();
          const diff = now - date;
          
          if (diff < 60000) return 'Just now';
          if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
          if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
          return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        };
        
        const copyError = (error) => {
          const text = `Error: ${error.message}\nType: ${error.type}\nTime: ${error.context.timestamp}\nStack: ${error.stack || 'N/A'}\nContext: ${JSON.stringify(error.context, null, 2)}`;
          navigator.clipboard.writeText(text);
          alert('Error details copied to clipboard!');
        };
        
        const exportErrors = () => {
          const data = ErrorTracker.export();
          const blob = new Blob([data], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `achieve-ai-errors-${new Date().toISOString().split('T')[0]}.json`;
          a.click();
        };
        
        const clearErrors = () => {
          if (confirm('Clear all error logs?')) {
            ErrorTracker.clear();
            setErrorStats(ErrorTracker.getStats());
          }
        };
        
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <button className="header-back" onClick={() => { setErrorStats(ErrorTracker.getStats()); setView('settings'); }}><Icons.arrowLeft /></button>
                <span className="header-title">Error Log</span>
              </div>
            </header>
            
            <div className="error-log-view fade-in">
              {/* Summary Stats */}
              <div className="error-summary">
                <div className="error-stat">
                  <div className={`error-stat-value ${stats.errors > 0 ? 'errors' : 'healthy'}`}>{stats.errors}</div>
                  <div className="error-stat-label">Errors</div>
                </div>
                <div className="error-stat">
                  <div className={`error-stat-value ${stats.warnings > 0 ? 'warnings' : 'healthy'}`}>{stats.warnings}</div>
                  <div className="error-stat-label">Warnings</div>
                </div>
                <div className="error-stat">
                  <div className="error-stat-value healthy">{stats.total}</div>
                  <div className="error-stat-label">Total</div>
                </div>
              </div>
              
              {stats.total === 0 ? (
                <div className="error-empty">
                  <div className="error-empty-icon"><Icons.shield /></div>
                  <h3 className="error-empty-title">All Clear!</h3>
                  <p className="error-empty-text">No errors or warnings have been logged. Your app is running smoothly.</p>
                </div>
              ) : (
                <>
                  {/* Filters */}
                  <div className="error-filters">
                    {[
                      { key: 'all', label: 'All', count: stats.total },
                      { key: 'error', label: 'Errors', count: stats.errors },
                      { key: 'warning', label: 'Warnings', count: stats.warnings },
                      { key: 'info', label: 'Info', count: stats.info },
                    ].map(f => (
                      <button 
                        key={f.key}
                        className={`error-filter ${errorFilter === f.key ? 'active' : ''}`}
                        onClick={() => setErrorFilter(f.key)}
                      >
                        {f.label}
                        {f.count > 0 && <span className="error-filter-count">{f.count}</span>}
                      </button>
                    ))}
                  </div>
                  
                  {/* Error List */}
                  <div className="error-list">
                    {errors.map(error => (
                      <div key={error.id} className="error-item">
                        <div className="error-item-header" onClick={() => setExpandedError(expandedError === error.id ? null : error.id)}>
                          <div className={`error-item-icon ${error.type}`}>
                            {error.type === 'error' ? <Icons.alertTriangle /> : 
                             error.type === 'warning' ? <Icons.alertTriangle /> : 
                             <Icons.info />}
                          </div>
                          <div className="error-item-content">
                            <p className="error-item-message">{error.message.slice(0, 100)}{error.message.length > 100 ? '...' : ''}</p>
                            <div className="error-item-meta">
                              <span style={{textTransform: 'capitalize', color: error.type === 'error' ? 'var(--red)' : error.type === 'warning' ? 'var(--orange)' : 'var(--accent)'}}>{error.type}</span>
                              <span className="error-item-time">{formatTime(error.context.timestamp)}</span>
                            </div>
                          </div>
                          <span className={`error-item-expand ${expandedError === error.id ? 'open' : ''}`}>
                            <Icons.chevronRight style={{transform: 'rotate(90deg)'}} />
                          </span>
                        </div>
                        
                        {expandedError === error.id && (
                          <div className="error-item-details">
                            <div className="error-detail-section">
                              <div className="error-detail-label">Full Message</div>
                              <div className="error-detail-code">{error.message}</div>
                            </div>
                            
                            {error.stack && (
                              <div className="error-detail-section">
                                <div className="error-detail-label">Stack Trace</div>
                                <div className="error-detail-code">{error.stack}</div>
                              </div>
                            )}
                            
                            <div className="error-detail-section">
                              <div className="error-detail-label">Context</div>
                              <div className="error-detail-code">{JSON.stringify(error.context, null, 2)}</div>
                            </div>
                            
                            <button className="error-copy-btn" onClick={() => copyError(error)}>
                              <Icons.copy /> Copy Error Details
                            </button>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                  
                  {/* Actions */}
                  <div className="error-actions">
                    <button className="error-action-btn" onClick={exportErrors}>
                      <Icons.arrowRight style={{transform: 'rotate(-45deg)'}} /> Export
                    </button>
                    <button className="error-action-btn danger" onClick={clearErrors}>
                      <Icons.trash /> Clear All
                    </button>
                  </div>
                </>
              )}
            </div>
          </div>
        );
      }
      
      // EDIT PROFILE (from settings)
      if (view === 'edit-profile') {
        return (
          <div className="app">
            <header className="header">
              <div className="header-left">
                <button className="header-back" onClick={() => setView('settings')}><Icons.arrowLeft /></button>
                <span className="header-title">Edit Profile</span>
              </div>
            </header>
            
            <div className="settings-view fade-in">
              <div className="profile-field">
                <label className="profile-label">Your Name</label>
                <input
                  className="profile-input"
                  type="text"
                  placeholder="e.g., Theyab"
                  value={userProfile.name}
                  onChange={(e) => setUserProfile({...userProfile, name: e.target.value})}
                />
              </div>

              <div className="profile-field">
                <label className="profile-label">Your Age</label>
                <input
                  className="profile-input"
                  type="number"
                  placeholder="e.g., 22"
                  value={userProfile.age}
                  onChange={(e) => setUserProfile({...userProfile, age: e.target.value})}
                />
              </div>

              <div className="profile-field">
                <label className="profile-label">Gender</label>
                <div className="profile-gender-options">
                  {['Male', 'Female', 'Other'].map(option => (
                    <button
                      key={option}
                      className={`profile-gender-btn ${userProfile.gender === option ? 'selected' : ''}`}
                      onClick={() => setUserProfile({...userProfile, gender: option})}
                    >
                      {option}
                    </button>
                  ))}
                </div>
              </div>
              
              <button 
                className="primary-btn" 
                style={{marginTop: '24px'}}
                onClick={() => { saveUserProfile(userProfile); setView('settings'); }}
              >
                Save Profile
              </button>
            </div>
          </div>
        );
      }

      return null;
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
